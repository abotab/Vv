<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>صفوان استوديو - الاستوديو</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <!-- Fabric.js for advanced canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="studio-body" id="studioBody">

  <!-- شاشة المشاريع -->
  <div class="projects-screen" id="projectsScreen">
    <div class="ps-header">
      <div class="ps-logo">
        <svg viewBox="0 0 60 60" class="ps-logo-icon">
          <defs><linearGradient id="psGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ff6b35"/><stop offset="100%" style="stop-color:#ff3d71"/></linearGradient></defs>
          <path d="M12,48 Q22,18 32,30 Q42,42 52,10" fill="none" stroke="url(#psGrad)" stroke-width="4" stroke-linecap="round"/>
          <circle cx="12" cy="48" r="4" fill="#ff6b35"/>
          <circle cx="52" cy="10" r="4" fill="#ff3d71"/>
        </svg>
        <span>صفوان استوديو</span>
      </div>
      <div class="ps-actions">
        <button class="ps-theme-btn" id="studioThemeBtn" onclick="toggleTheme()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
        </button>
        <a href="index.html" class="ps-home-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
          الرئيسية
        </a>
      </div>
    </div>

    <div class="ps-content">
      <div class="ps-welcome">
        <h1>مشاريعك</h1>
        <div class="ps-btns">
          <button class="ps-new-btn" onclick="showNewProjectFromStudio()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
            مشروع جديد
          </button>
          <button class="ps-template-btn" onclick="loadFireTemplate()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2c0 0-5 4.5-5 9a5 5 0 0 0 10 0c0-4.5-5-9-5-9z"/>
              <path d="M12 12c0 0-2.5 2-2.5 4a2.5 2.5 0 0 0 5 0c0-2-2.5-4-2.5-4z"/>
            </svg>
            مشروع جاهز - نار متحركة
          </button>
        </div>
      </div>

      <div class="ps-search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="projectSearch" placeholder="ابحث في مشاريعك..." oninput="filterProjects(this.value)">
      </div>

      <div class="ps-grid" id="projectsGrid">
        <!-- المشاريع ستُضاف هنا ديناميكيًا -->
        <div class="ps-empty" id="psEmpty">
          <svg viewBox="0 0 120 120" fill="none">
            <circle cx="60" cy="60" r="50" stroke="currentColor" stroke-width="2" stroke-dasharray="8 4" opacity="0.2"/>
            <path d="M40,80 Q50,45 60,60 Q70,75 80,30" stroke="currentColor" stroke-width="3" stroke-linecap="round" opacity="0.3"/>
          </svg>
          <p>لا توجد مشاريع بعد</p>
          <span>ابدأ مشروعًا جديدًا الآن</span>
        </div>
      </div>
    </div>
  </div>

  <!-- نافذة مشروع جديد من الاستوديو -->
  <div class="modal-overlay" id="studioNewProjectModal">
    <div class="modal-box">
      <button class="modal-close" onclick="hideStudioNewProject()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      <h2 class="modal-title">مشروع جديد</h2>
      <div class="project-type-tabs">
        <button class="tab-btn active" data-tab="static" onclick="switchStudioTab('static')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
          رسم ثابت
        </button>
        <button class="tab-btn" data-tab="animated" onclick="switchStudioTab('animated')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
          رسم متحرك
        </button>
      </div>
      <div class="modal-form">
        <div class="form-group">
          <label>حجم اللوحة</label>
          <div class="size-presets">
            <button class="size-btn active" onclick="selectStudioSize(this,1080,1080)">مربع</button>
            <button class="size-btn" onclick="selectStudioSize(this,1080,1920)">تيك توك</button>
            <button class="size-btn" onclick="selectStudioSize(this,1920,1080)">يوتيوب</button>
            <button class="size-btn" onclick="selectStudioSize(this,1080,1080)">انستقرام</button>
            <button class="size-btn" onclick="selectStudioSize(this,2480,3508)">A4</button>
            <button class="size-btn" onclick="selectStudioSize(this,3840,2160)">4K</button>
            <button class="size-btn" onclick="toggleStudioCustomSize()">مخصص</button>
          </div>
          <div class="custom-size" id="studioCustomSize" style="display:none">
            <input type="number" id="sCustomW" placeholder="العرض" value="1000" min="100" max="8000">
            <span>×</span>
            <input type="number" id="sCustomH" placeholder="الارتفاع" value="1000" min="100" max="8000">
            <span class="size-unit">بكسل</span>
          </div>
        </div>
        <div class="form-group">
          <label>لون الخلفية</label>
          <div class="bg-options">
            <button class="bg-opt active" onclick="selectStudioBg(this,'#ffffff')" style="background:#ffffff;border:2px solid #ddd">
              <svg viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2"><path d="M9 12l2 2 4-4"/></svg>
            </button>
            <button class="bg-opt" onclick="selectStudioBg(this,'#1a1a2e')" style="background:#1a1a2e">
              <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" style="opacity:0"><path d="M9 12l2 2 4-4"/></svg>
            </button>
            <button class="bg-opt transparent-bg" onclick="selectStudioBg(this,'transparent')">شفاف</button>
            <input type="color" id="studioBgPicker" value="#ffffff" onchange="selectStudioBg(null,this.value)">
          </div>
        </div>
        <div id="studioAnimSettings" style="display:none">
          <div class="form-group">
            <label>معدل الإطارات</label>
            <div class="fps-options">
              <button class="fps-btn" onclick="selectStudioFPS(this,12)">12 FPS</button>
              <button class="fps-btn active" onclick="selectStudioFPS(this,24)">24 FPS</button>
              <button class="fps-btn" onclick="selectStudioFPS(this,30)">30 FPS</button>
            </div>
          </div>
        </div>
      </div>
      <button class="btn-create" onclick="createStudioProject()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
        إنشاء المشروع
      </button>
    </div>
  </div>

  <!-- بيئة الرسم الرئيسية -->
  <div class="studio-app" id="studioApp" style="display:none">

    <!-- شريط القائمة العلوي -->
    <div class="studio-menubar">
      <div class="menu-left">
        <button class="menu-logo-btn" onclick="exitToProjects()">
          <svg viewBox="0 0 30 30" fill="none">
            <path d="M5,24 Q10,8 15,14 Q20,20 25,5" stroke="#ff6b35" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="menu-items">
          <div class="menu-item" onclick="toggleMenu(this)">
            ملف
            <div class="menu-dropdown">
              <div class="menu-opt" onclick="newFileFromMenu()">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 3h8l4 4v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z"/><path d="M12 3v4h4"/></svg>
                مشروع جديد
              </div>
              <div class="menu-opt" onclick="saveProject()">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h11l4 4v13a1 1 0 0 1-1 1z"/><path d="M7 21v-8h6v8"/></svg>
                حفظ
              </div>
              <div class="menu-separator"></div>
              <div class="menu-opt" onclick="exportAs('png')">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M7 16l-4-4 4-4M17 12H3"/></svg>
                تصدير PNG
              </div>
              <div class="menu-opt" onclick="exportAs('jpg')">تصدير JPEG</div>
              <div class="menu-opt" onclick="exportAs('webp')">تصدير WebP</div>
              <div class="menu-opt" onclick="exportLayersAsPNG()">تصدير الطبقات منفردة</div>
              <div class="menu-opt" id="exportVideoOpt" onclick="exportVideo()">تصدير فيديو (GIF/WebM)</div>
            </div>
          </div>
          <div class="menu-item" onclick="toggleMenu(this)">
            تحرير
            <div class="menu-dropdown">
              <div class="menu-opt" onclick="historyUndo()">تراجع (Ctrl+Z)</div>
              <div class="menu-opt" onclick="historyRedo()">إعادة (Ctrl+Y)</div>
              <div class="menu-separator"></div>
              <div class="menu-opt" onclick="copySelected()">نسخ (Ctrl+C)</div>
              <div class="menu-opt" onclick="pasteContent()">لصق (Ctrl+V)</div>
              <div class="menu-opt" onclick="cutSelected()">قص (Ctrl+X)</div>
              <div class="menu-separator"></div>
              <div class="menu-opt" onclick="selectAll()">تحديد الكل (Ctrl+A)</div>
              <div class="menu-opt" onclick="deselectAll()">إلغاء التحديد</div>
              <div class="menu-opt" onclick="invertSelection()">عكس التحديد</div>
            </div>
          </div>
          <div class="menu-item" onclick="toggleMenu(this)">
            عرض
            <div class="menu-dropdown">
              <div class="menu-opt" onclick="toggleGrid()">إظهار/إخفاء الشبكة</div>
              <div class="menu-opt" onclick="toggleRulers()">إظهار/إخفاء المسطرة</div>
              <div class="menu-opt" onclick="toggleGuides()">إظهار/إخفاء الخطوط المرجعية</div>
              <div class="menu-separator"></div>
              <div class="menu-opt" onclick="zoomIn()">تكبير (+)</div>
              <div class="menu-opt" onclick="zoomOut()">تصغير (-)</div>
              <div class="menu-opt" onclick="zoomFit()">ملاءمة الشاشة</div>
              <div class="menu-opt" onclick="zoom100()">100%</div>
              <div class="menu-separator"></div>
              <div class="menu-opt" onclick="toggleFullscreen()">وضع الشاشة الكاملة (F11)</div>
              <div class="menu-opt" onclick="toggleSidebarLeft()">إخفاء/إظهار الشريط الجانبي</div>
            </div>
          </div>
          <div class="menu-item" onclick="toggleMenu(this)">
            صورة
            <div class="menu-dropdown">
              <div class="menu-opt" onclick="importReferenceImage()">استيراد صورة مرجعية</div>
              <div class="menu-opt" onclick="flipCanvasH()">قلب أفقي</div>
              <div class="menu-opt" onclick="flipCanvasV()">قلب رأسي</div>
              <div class="menu-opt" onclick="rotateCanvas90()">تدوير 90 درجة</div>
              <div class="menu-opt" onclick="resizeCanvas()">تغيير حجم اللوحة</div>
            </div>
          </div>
          <div class="menu-item" onclick="toggleMenu(this)">
            إعدادات
            <div class="menu-dropdown">
              <div class="menu-opt" onclick="toggleTheme()">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="10" cy="10" r="4"/><path d="M10 1v2M10 17v2M3 3l1.4 1.4M15.6 15.6l1.4 1.4M1 10h2M17 10h2M3 17l1.4-1.4M15.6 4.4l1.4-1.4"/></svg>
                وضع ليلي / نهاري
              </div>
              <div class="menu-opt" onclick="showShortcuts()">اختصارات لوحة المفاتيح</div>
              <div class="menu-opt" onclick="showCanvasSettings()">إعدادات اللوحة</div>
            </div>
          </div>
        </div>
      </div>
      <div class="menu-center">
        <span class="project-name" id="projectNameDisplay">بدون عنوان</span>
        <div class="zoom-controls">
          <button onclick="zoomOut()" title="تصغير">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="9" r="6"/><path d="M15 15l3 3M6 9h6"/></svg>
          </button>
          <span id="zoomDisplay">100%</span>
          <button onclick="zoomIn()" title="تكبير">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="9" r="6"/><path d="M15 15l3 3M9 6v6M6 9h6"/></svg>
          </button>
        </div>
      </div>
      <div class="menu-right">
        <button class="menu-action-btn" onclick="historyUndo()" title="تراجع">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg>
        </button>
        <button class="menu-action-btn" onclick="historyRedo()" title="إعادة">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 14 20 9 15 4"/><path d="M4 20v-7a4 4 0 0 1 4-4h12"/></svg>
        </button>
        <button class="menu-action-btn" onclick="saveProject()" title="حفظ">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        </button>
        <button class="menu-action-btn export-btn" onclick="quickExport()" title="تصدير سريع">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          تصدير
        </button>
        <button class="menu-action-btn" onclick="exitToProjects()" title="خروج">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          خروج
        </button>
      </div>
    </div>

    <!-- الجسم الرئيسي -->
    <div class="studio-main">

      <!-- الشريط الجانبي الأيمن - الأدوات -->
      <div class="tools-sidebar" id="toolsSidebar">

        <!-- مجموعة: أدوات التحديد -->
        <div class="tool-group">
          <div class="tool-group-header" onclick="toggleToolGroup(this)">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M4 4l8 3-3 8-2-4-4-2 8-3z"/>
            </svg>
            <span>التحديد</span>
            <svg class="group-arrow" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l5 5 5-5"/></svg>
          </div>
          <div class="tool-items active">
            <button class="tool-btn" id="tool-select" onclick="setTool('select')" title="أداة التحرير والتحديد">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 3l14 9-7 1-3 7z"/></svg>
              <span>تحديد</span>
            </button>
            <button class="tool-btn" id="tool-rect-select" onclick="setTool('rect-select')" title="تحديد مستطيل">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2"><rect x="4" y="4" width="16" height="16" rx="1"/></svg>
              <span>مستطيل</span>
            </button>
            <button class="tool-btn" id="tool-ellipse-select" onclick="setTool('ellipse-select')" title="تحديد دائري">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="4 2"><ellipse cx="12" cy="12" rx="9" ry="7"/></svg>
              <span>دائري</span>
            </button>
            <button class="tool-btn" id="tool-lasso" onclick="setTool('lasso')" title="تحديد حر">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2"><path d="M6 6 Q4 12 6 18 Q12 22 18 18 Q22 12 18 6 Q12 2 6 6z"/></svg>
              <span>لاسو</span>
            </button>
            <button class="tool-btn" id="tool-magic-wand" onclick="setTool('magic-wand')" title="العصا السحرية">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 4V2M15 16v-2M8 9H6M21 9h-2M17.8 11.8L19.2 13.2M10.2 4.2L11.6 5.6M17.8 6.2L19.2 4.8M10.2 13.8L11.6 12.4"/><line x1="4" y1="20" x2="12" y2="12"/></svg>
              <span>سحرية</span>
            </button>
          </div>
        </div>

        <!-- مجموعة: أدوات الرسم -->
        <div class="tool-group">
          <div class="tool-group-header" onclick="toggleToolGroup(this)">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 17l5-5 3 3 5-8 3 10H3z" stroke-linecap="round"/></svg>
            <span>الرسم</span>
            <svg class="group-arrow" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l5 5 5-5"/></svg>
          </div>
          <div class="tool-items active">
            <button class="tool-btn active" id="tool-brush" onclick="setTool('brush')" title="فرشاة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.06 11.9l8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08"/><path d="M7.07 14.94C5.79 16.2 5 17.99 5 21l3-.5c.24-1.5.6-2.8 1.4-3.6"/></svg>
              <span>فرشاة</span>
            </button>
            <button class="tool-btn" id="tool-pencil" onclick="setTool('pencil')" title="قلم رصاص">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
              <span>قلم</span>
            </button>
            <button class="tool-btn" id="tool-pen" onclick="setTool('pen')" title="قلم حبر">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>
              <span>قلم بيزييه</span>
            </button>
            <button class="tool-btn" id="tool-eraser" onclick="setTool('eraser')" title="ممحاة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 20H7L3 16l9-9 8 8-2 2z"/><path d="M6.26 6.26L3 3"/></svg>
              <span>ممحاة</span>
            </button>
            <button class="tool-btn" id="tool-fill" onclick="setTool('fill')" title="دلو طلاء">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11L8.6 1.6a2 2 0 0 0-2.8 0l-1.3 1.3a2 2 0 0 0 0 2.8L14.9 16"/><path d="M3 21s2-4 6-4 6 4 6 4"/></svg>
              <span>تعبئة</span>
            </button>
            <button class="tool-btn" id="tool-spray" onclick="setTool('spray')" title="رش">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="8" cy="16" r="4"/><path d="M8 12V8"/><path d="M8 8H14"/><path d="M14 4v8"/><circle cx="17" cy="5" r="1" fill="currentColor"/><circle cx="20" cy="4" r="1" fill="currentColor"/><circle cx="19" cy="8" r="1" fill="currentColor"/></svg>
              <span>رش</span>
            </button>
          </div>
        </div>

        <!-- مجموعة: الأشكال -->
        <div class="tool-group">
          <div class="tool-group-header" onclick="toggleToolGroup(this)">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="6" height="6" rx="1"/><circle cx="14" cy="14" r="3"/><path d="M3 14l4-8 4 8H3z"/></svg>
            <span>الأشكال</span>
            <svg class="group-arrow" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l5 5 5-5"/></svg>
          </div>
          <div class="tool-items">
            <button class="tool-btn" id="tool-line" onclick="setTool('line')" title="خط مستقيم">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="19" x2="19" y2="5"/></svg>
              <span>خط</span>
            </button>
            <button class="tool-btn" id="tool-rect" onclick="setTool('rect')" title="مستطيل">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="6" width="18" height="12" rx="2"/></svg>
              <span>مستطيل</span>
            </button>
            <button class="tool-btn" id="tool-circle" onclick="setTool('circle')" title="دائرة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/></svg>
              <span>دائرة</span>
            </button>
            <button class="tool-btn" id="tool-triangle" onclick="setTool('triangle')" title="مثلث">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3l9 17H3z"/></svg>
              <span>مثلث</span>
            </button>
            <button class="tool-btn" id="tool-polygon" onclick="setTool('polygon')" title="مضلع">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l9 7-4 10H7L3 9z"/></svg>
              <span>مضلع</span>
            </button>
            <button class="tool-btn" id="tool-star" onclick="setTool('star')" title="نجمة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              <span>نجمة</span>
            </button>
            <button class="tool-btn" id="tool-bezier" onclick="setTool('bezier')" title="منحنى بيزييه">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 17 C5 5, 19 5, 21 17"/></svg>
              <span>منحنى</span>
            </button>
          </div>
        </div>

        <!-- مجموعة: أدوات متقدمة -->
        <div class="tool-group">
          <div class="tool-group-header" onclick="toggleToolGroup(this)">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 2a8 8 0 1 0 0 16A8 8 0 0 0 10 2zM10 6v4l3 3"/></svg>
            <span>أدوات متقدمة</span>
            <svg class="group-arrow" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l5 5 5-5"/></svg>
          </div>
          <div class="tool-items">
            <button class="tool-btn" id="tool-smudge" onclick="setTool('smudge')" title="تمويه/مزج">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12s4-8 9-8 9 8 9 8-4 8-9 8-9-8-9-8z" stroke-dasharray="3 2"/><circle cx="12" cy="12" r="3"/></svg>
              <span>تمويه</span>
            </button>
            <button class="tool-btn" id="tool-blur" onclick="setTool('blur')" title="ضبابية">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9" stroke-dasharray="4 2"/><circle cx="12" cy="12" r="5"/></svg>
              <span>ضبابية</span>
            </button>
            <button class="tool-btn" id="tool-clone" onclick="setTool('clone')" title="نسخ طبق الأصل">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              <span>استنساخ</span>
            </button>
            <button class="tool-btn" id="tool-text" onclick="setTool('text')" title="نص">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>
              <span>نص</span>
            </button>
            <button class="tool-btn" id="tool-eyedropper" onclick="setTool('eyedropper')" title="قطارة اللون">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 11l-3 3-3-3 5-5 1 5z"/><path d="M3.5 20.5l5-5"/><line x1="8.5" y1="15.5" x2="14" y2="10"/></svg>
              <span>قطارة</span>
            </button>
            <button class="tool-btn" id="tool-crop" onclick="setTool('crop')" title="قص اللوحة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6.13 1 6 16a2 2 0 0 0 2 2h15"/><polyline points="1 6.13 16 6 16 21"/></svg>
              <span>قص</span>
            </button>
          </div>
        </div>

        <!-- مجموعة: التنقل -->
        <div class="tool-group">
          <div class="tool-group-header" onclick="toggleToolGroup(this)">
            <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 3v14M3 10h14"/></svg>
            <span>التنقل</span>
            <svg class="group-arrow" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l5 5 5-5"/></svg>
          </div>
          <div class="tool-items">
            <button class="tool-btn" id="tool-hand" onclick="setTool('hand')" title="يد التنقل">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 11V6a2 2 0 0 0-2-2 2 2 0 0 0-2 2"/><path d="M14 10V4a2 2 0 0 0-2-2 2 2 0 0 0-2 2v2"/><path d="M10 10.5V6a2 2 0 0 0-2-2 2 2 0 0 0-2 2v8"/><path d="M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></svg>
              <span>تنقل</span>
            </button>
            <button class="tool-btn" id="tool-zoom-tool" onclick="setTool('zoom-tool')" title="تكبير/تصغير">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/><path d="M11 8v6M8 11h6"/></svg>
              <span>تكبير</span>
            </button>
            <button class="tool-btn" id="tool-rotate" onclick="setTool('rotate')" title="تدوير اللوحة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
              <span>تدوير</span>
            </button>
          </div>
        </div>

      </div>

      <!-- منطقة اللوحة المركزية -->
      <div class="canvas-area" id="canvasArea">
        <!-- المسطرة العلوية -->
        <div class="ruler ruler-h" id="rulerH">
          <canvas id="rulerHCanvas"></canvas>
        </div>
        <!-- المسطرة الجانبية -->
        <div class="ruler ruler-v" id="rulerV">
          <canvas id="rulerVCanvas"></canvas>
        </div>

        <!-- منطقة التمرير -->
        <div class="canvas-scroll-area" id="canvasScrollArea">
          <div class="canvas-wrapper" id="canvasWrapper">
            <canvas id="mainCanvas"></canvas>
          </div>
        </div>

        <!-- شريط الأنيميشن (يظهر فقط للرسم المتحرك) -->
        <div class="animation-bar" id="animationBar" style="display:none">
          <div class="anim-controls">
            <button onclick="animGoToStart()" title="بداية">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="11 17 6 12 11 7"/><polyline points="18 17 13 12 18 7"/></svg>
            </button>
            <button onclick="animPrevFrame()" title="إطار سابق">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
            <button onclick="togglePlay()" id="playBtn" title="تشغيل/إيقاف" class="play-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="playIcon"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            </button>
            <button onclick="animNextFrame()" title="إطار تالٍ">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
            </button>
            <button onclick="animGoToEnd()" title="نهاية">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/></svg>
            </button>
            <button onclick="toggleLoop()" id="loopBtn" title="تكرار" class="loop-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
            </button>
            <div class="anim-fps">
              <span>FPS:</span>
              <select id="fpsSelect" onchange="changeFPS(this.value)">
                <option value="8">8</option>
                <option value="12">12</option>
                <option value="24" selected>24</option>
                <option value="30">30</option>
                <option value="60">60</option>
              </select>
            </div>
          </div>

          <!-- شريط الإطارات -->
          <div class="frames-track">
            <div class="frames-list" id="framesList">
              <!-- الإطارات ستضاف هنا -->
            </div>
            <button class="add-frame-btn" onclick="addFrame()" title="إضافة إطار">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
            </button>
          </div>

          <div class="anim-info">
            <span id="currentFrameDisplay">إطار 1 / 1</span>
            <span id="totalDurationDisplay">0.0 ثانية</span>
          </div>
        </div>
      </div>

      <!-- الشريط الجانبي الأيسر -->
      <div class="right-sidebar" id="rightSidebar">

        <!-- تبويبات الشريط -->
        <div class="sidebar-tabs">
          <button class="stab active" onclick="switchSideTab('colors')" data-tab="colors">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/><path d="M12 3v9l4 4"/></svg>
            الألوان
          </button>
          <button class="stab" onclick="switchSideTab('brushes')" data-tab="brushes">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.06 11.9l8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08"/><path d="M7.07 14.94C5.79 16.2 5 17.99 5 21l3-.5c.24-1.5.6-2.8 1.4-3.6"/></svg>
            الفرش
          </button>
          <button class="stab" onclick="switchSideTab('layers')" data-tab="layers">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
            الطبقات
          </button>
          <button class="stab" onclick="switchSideTab('props')" data-tab="props">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93A10 10 0 1 1 4.93 19.07"/></svg>
            خصائص
          </button>
        </div>

        <!-- تبويب الألوان -->
        <div class="sidebar-panel active" id="panel-colors">
          <!-- اختيار اللون الأساسي والثانوي -->
          <div class="color-swatches-main">
            <div class="color-fg" id="colorFG" title="اللون الأمامي" onclick="openColorPicker('fg')"></div>
            <div class="color-bg" id="colorBG" title="لون الخلفية" onclick="openColorPicker('bg')"></div>
            <button class="swap-colors" onclick="swapColors()" title="تبادل الألوان">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M7 16V4M7 4L3 8M7 4L11 8"/><path d="M17 8v12M17 20l4-4M17 20l-4-4"/></svg>
            </button>
            <button class="reset-colors" onclick="resetColors()" title="إعادة تعيين">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            </button>
          </div>

          <!-- منتقي اللون المتقدم -->
          <div class="color-picker-area">
            <div class="color-spectrum" id="colorSpectrum">
              <canvas id="spectrumCanvas" width="220" height="150"></canvas>
              <div class="spectrum-cursor" id="spectrumCursor"></div>
            </div>
            <div class="hue-slider-wrap">
              <canvas id="hueCanvas" width="220" height="18"></canvas>
              <div class="hue-cursor" id="hueCursor"></div>
            </div>
            <div class="alpha-slider-wrap">
              <canvas id="alphaCanvas" width="220" height="18"></canvas>
              <div class="alpha-cursor" id="alphaCursor"></div>
            </div>
            <div class="color-inputs">
              <div class="color-input-wrap">
                <label>HEX</label>
                <input type="text" id="hexInput" value="#ff6b35" onchange="updateFromHex(this.value)">
              </div>
              <div class="color-input-wrap">
                <label>R</label><input type="number" id="rInput" min="0" max="255" value="255" onchange="updateFromRGB()">
              </div>
              <div class="color-input-wrap">
                <label>G</label><input type="number" id="gInput" min="0" max="255" value="107" onchange="updateFromRGB()">
              </div>
              <div class="color-input-wrap">
                <label>B</label><input type="number" id="bInput" min="0" max="255" value="53" onchange="updateFromRGB()">
              </div>
            </div>
          </div>

          <!-- لوحة الألوان -->
          <div class="palette-section">
            <div class="palette-header">
              <span>لوحة الألوان</span>
              <div class="palette-filters">
                <button class="pf-btn active" onclick="filterPalette('all', this)">الكل</button>
                <button class="pf-btn" onclick="filterPalette('skin', this)">بشرة</button>
                <button class="pf-btn" onclick="filterPalette('warm', this)">دافئة</button>
                <button class="pf-btn" onclick="filterPalette('cool', this)">باردة</button>
                <button class="pf-btn" onclick="filterPalette('nature', this)">طبيعة</button>
              </div>
            </div>
            <div class="palette-grid" id="paletteGrid">
              <!-- ستُضاف الألوان بـ JS -->
            </div>
          </div>

          <!-- الألوان الأخيرة -->
          <div class="recent-colors">
            <span>الألوان الأخيرة</span>
            <div class="recent-grid" id="recentColors"></div>
          </div>
        </div>

        <!-- تبويب الفرش -->
        <div class="sidebar-panel" id="panel-brushes">
          <div class="brush-categories">
            <button class="bc-btn active" onclick="filterBrushes('safwan', this)">فرش صفوان</button>
            <button class="bc-btn" onclick="filterBrushes('basic', this)">أساسية</button>
            <button class="bc-btn" onclick="filterBrushes('texture', this)">نسيج</button>
            <button class="bc-btn" onclick="filterBrushes('special', this)">خاصة</button>
          </div>
          <div class="brush-list" id="brushList">
            <!-- الفرش ستضاف بـ JS -->
          </div>

          <!-- إعدادات الفرشاة -->
          <div class="brush-settings">
            <div class="bs-row">
              <label>الحجم</label>
              <input type="range" id="brushSize" min="1" max="500" value="20" oninput="updateBrushSize(this.value)">
              <span id="brushSizeVal">20</span>
            </div>
            <div class="bs-row">
              <label>الشفافية</label>
              <input type="range" id="brushOpacity" min="1" max="100" value="100" oninput="updateBrushOpacity(this.value)">
              <span id="brushOpacityVal">100%</span>
            </div>
            <div class="bs-row">
              <label>التدفق</label>
              <input type="range" id="brushFlow" min="1" max="100" value="100" oninput="updateBrushFlow(this.value)">
              <span id="brushFlowVal">100%</span>
            </div>
            <div class="bs-row">
              <label>التنعيم</label>
              <input type="range" id="brushSmooth" min="0" max="100" value="50" oninput="updateBrushSmooth(this.value)">
              <span id="brushSmoothVal">50</span>
            </div>
            <div class="bs-row">
              <label>الصلابة</label>
              <input type="range" id="brushHardness" min="0" max="100" value="80" oninput="updateBrushHardness(this.value)">
              <span id="brushHardnessVal">80%</span>
            </div>
            <div class="bs-row">
              <label>المسافة</label>
              <input type="range" id="brushSpacing" min="1" max="100" value="5" oninput="updateBrushSpacing(this.value)">
              <span id="brushSpacingVal">5%</span>
            </div>
          </div>
        </div>

        <!-- تبويب الطبقات -->
        <div class="sidebar-panel" id="panel-layers">
          <div class="layers-toolbar">
            <button class="lt-btn" onclick="addLayer()" title="طبقة جديدة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
            </button>
            <button class="lt-btn" onclick="duplicateLayer()" title="تكرار الطبقة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <button class="lt-btn" onclick="mergeLayerDown()" title="دمج للأسفل">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
            </button>
            <button class="lt-btn" onclick="flattenLayers()" title="دمج كل الطبقات">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-3"/><polyline points="16 3 21 3 21 8"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            </button>
            <button class="lt-btn danger" onclick="deleteLayer()" title="حذف الطبقة">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
            </button>
          </div>

          <!-- وضع المزج -->
          <div class="blend-mode-row">
            <select id="blendModeSelect" onchange="setLayerBlendMode(this.value)">
              <option value="source-over">عادي</option>
              <option value="multiply">ضرب (Multiply)</option>
              <option value="screen">شاشة (Screen)</option>
              <option value="overlay">تغطية (Overlay)</option>
              <option value="soft-light">ضوء ناعم</option>
              <option value="hard-light">ضوء قوي</option>
              <option value="color-dodge">تبييض</option>
              <option value="color-burn">تعتيم</option>
              <option value="difference">فرق</option>
              <option value="exclusion">استثناء</option>
              <option value="hue">تدرج</option>
              <option value="saturation">تشبع</option>
              <option value="luminosity">سطوع</option>
            </select>
            <div class="layer-opacity-ctrl">
              <input type="range" id="layerOpacity" min="0" max="100" value="100" oninput="setLayerOpacity(this.value)">
              <span id="layerOpacityVal">100%</span>
            </div>
          </div>

          <div class="layers-list" id="layersList">
            <!-- الطبقات ستضاف هنا -->
          </div>
        </div>

        <!-- تبويب الخصائص -->
        <div class="sidebar-panel" id="panel-props">
          <!-- مرجع الرسم -->
          <div class="props-section">
            <div class="props-title">مرجع الرسم</div>
            <button class="props-btn" onclick="importReferenceImage()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9l4 4 4-4 4 6 4-6"/></svg>
              استيراد صورة مرجعية
            </button>
            <div class="ref-controls" id="refControls" style="display:none">
              <div class="rc-row">
                <label>الشفافية</label>
                <input type="range" id="refOpacity" min="10" max="100" value="50" oninput="setRefOpacity(this.value)">
                <span id="refOpacityVal">50%</span>
              </div>
              <div class="rc-row">
                <label>الحجم</label>
                <input type="range" id="refScale" min="10" max="200" value="100" oninput="setRefScale(this.value)">
                <span id="refScaleVal">100%</span>
              </div>
              <div class="rc-buttons">
                <button onclick="lockRefLayer()" class="rc-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                  قفل
                </button>
                <button onclick="removeRefImage()" class="rc-btn danger">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg>
                  حذف
                </button>
              </div>
            </div>
          </div>

          <!-- إعدادات اللوحة -->
          <div class="props-section">
            <div class="props-title">إعدادات اللوحة</div>
            <div class="canvas-info" id="canvasInfo">
              <div class="ci-item"><span>العرض:</span><strong id="ciW">-</strong></div>
              <div class="ci-item"><span>الارتفاع:</span><strong id="ciH">-</strong></div>
              <div class="ci-item"><span>DPI:</span><strong id="ciDPI">-</strong></div>
              <div class="ci-item"><span>الطبقات:</span><strong id="ciLayers">-</strong></div>
            </div>
            <button class="props-btn" onclick="showCanvasSettings()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93A10 10 0 1 1 4.93 19.07"/></svg>
              إعدادات اللوحة
            </button>
          </div>

          <!-- الشبكة والمساعدات -->
          <div class="props-section">
            <div class="props-title">المساعدات البصرية</div>
            <div class="toggle-row">
              <label>الشبكة</label>
              <button class="toggle-btn" id="gridToggle" onclick="toggleGrid()">إيقاف</button>
            </div>
            <div class="toggle-row">
              <label>المسطرة</label>
              <button class="toggle-btn" id="rulerToggle" onclick="toggleRulers()">إيقاف</button>
            </div>
            <div class="toggle-row" id="snapRow">
              <label>محاذاة للشبكة</label>
              <button class="toggle-btn" id="snapToggle" onclick="toggleSnap()">إيقاف</button>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

  <!-- نافذة الإعدادات -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal-box settings-box">
      <button class="modal-close" onclick="closeModal('settingsModal')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
      <h2 class="modal-title">إعدادات</h2>
      <div class="settings-list">
        <div class="setting-item">
          <div>
            <div class="si-label">الوضع الليلي</div>
            <div class="si-desc">تبديل بين الوضع الليلي والنهاري</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="darkModeSwitch" onchange="toggleTheme()">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div>
            <div class="si-label">إظهار الشبكة</div>
            <div class="si-desc">شبكة مساعدة على اللوحة</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="gridSwitch" onchange="toggleGrid()">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div>
            <div class="si-label">إظهار المسطرة</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="rulerSwitch" onchange="toggleRulers()" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div>
            <div class="si-label">التبديل التلقائي حسب النظام</div>
            <div class="si-desc">يتابع إعداد الجهاز تلقائيًا</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="systemThemeSwitch">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- نافذة الاختصارات -->
  <div class="modal-overlay" id="shortcutsModal">
    <div class="modal-box shortcuts-box">
      <button class="modal-close" onclick="closeModal('shortcutsModal')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
      <h2 class="modal-title">اختصارات لوحة المفاتيح</h2>
      <div class="shortcuts-grid">
        <div class="sc-item"><kbd>Ctrl+Z</kbd><span>تراجع</span></div>
        <div class="sc-item"><kbd>Ctrl+Y</kbd><span>إعادة</span></div>
        <div class="sc-item"><kbd>Ctrl+C</kbd><span>نسخ</span></div>
        <div class="sc-item"><kbd>Ctrl+V</kbd><span>لصق</span></div>
        <div class="sc-item"><kbd>Ctrl+S</kbd><span>حفظ</span></div>
        <div class="sc-item"><kbd>Ctrl+A</kbd><span>تحديد الكل</span></div>
        <div class="sc-item"><kbd>B</kbd><span>فرشاة</span></div>
        <div class="sc-item"><kbd>E</kbd><span>ممحاة</span></div>
        <div class="sc-item"><kbd>V</kbd><span>أداة التحديد</span></div>
        <div class="sc-item"><kbd>G</kbd><span>دلو تعبئة</span></div>
        <div class="sc-item"><kbd>I</kbd><span>قطارة اللون</span></div>
        <div class="sc-item"><kbd>T</kbd><span>أداة النص</span></div>
        <div class="sc-item"><kbd>H</kbd><span>يد التنقل</span></div>
        <div class="sc-item"><kbd>+/-</kbd><span>تكبير/تصغير</span></div>
        <div class="sc-item"><kbd>Ctrl+D</kbd><span>إلغاء التحديد</span></div>
        <div class="sc-item"><kbd>F11</kbd><span>شاشة كاملة</span></div>
        <div class="sc-item"><kbd>[/]</kbd><span>حجم الفرشاة</span></div>
        <div class="sc-item"><kbd>X</kbd><span>تبادل الألوان</span></div>
        <div class="sc-item"><kbd>Space</kbd><span>تشغيل/إيقاف (أنيميشن)</span></div>
        <div class="sc-item"><kbd>Ctrl+E</kbd><span>تصدير PNG</span></div>
      </div>
    </div>
  </div>

  <!-- إشعار -->
  <div class="toast" id="toast"></div>

  <!-- شريط الحالة -->
  <div class="status-bar">
    <span id="statusTool">الأداة: فرشاة</span>
    <span id="statusCoords">X: 0, Y: 0</span>
    <span id="statusZoom">تكبير: 100%</span>
    <span id="statusSize">اللوحة: - × -</span>
  </div>

  <script src="studio.js"></script>
</body>
</html>
