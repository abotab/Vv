<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>صفوان ستوديو — لوحة الرسم</title>
<link rel="stylesheet" href="style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="studio-page" id="studioBody">

<!-- شريط العنوان العلوي -->
<div class="studio-titlebar">
  <div class="titlebar-right">
    <button class="tb-btn home-btn" onclick="goHome()" title="الصفحة الرئيسية">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
    </button>
    <div class="project-title-wrap">
      <span class="project-title" id="projectTitleDisplay">مشروع جديد</span>
      <button class="edit-title-btn" onclick="editTitle()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
      </button>
    </div>
  </div>
  
  <div class="titlebar-center">
    <div class="toolbar-main" id="mainToolbar">
      
      <!-- مجموعة: أدوات الرسم الأساسية -->
      <div class="tool-group" id="tg-draw">
        <button class="tool-group-btn active" onclick="toggleToolGroup('tg-draw')" title="أدوات الرسم">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
          </svg>
          <span>الرسم</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn active" data-tool="brush" onclick="selectTool('brush')" title="فرشاة الرسم">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L4.08 13.6a5.5 5.5 0 0 0 7.78 7.78l8.98-8.97a5.5 5.5 0 0 0 0-7.8z"/>
            </svg>
            <span>فرشاة</span>
          </button>
          <button class="tool-btn" data-tool="pencil" onclick="selectTool('pencil')" title="قلم رصاص">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="2" x2="22" y2="6"/>
              <path d="M7.5 20.5 19 9l-4-4L3.5 16.5l4 4z"/>
            </svg>
            <span>قلم رصاص</span>
          </button>
          <button class="tool-btn" data-tool="pen" onclick="selectTool('pen')" title="قلم حبر">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19l7-7 3 3-7 7-3-3z"/>
              <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              <path d="M2 2l7.586 7.586"/>
            </svg>
            <span>قلم حبر</span>
          </button>
          <button class="tool-btn" data-tool="marker" onclick="selectTool('marker')" title="ماركر">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="10" width="10" height="4" rx="1"/>
              <path d="M12 12h8a2 2 0 0 0 0-4h-8M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2"/>
            </svg>
            <span>ماركر</span>
          </button>
          <button class="tool-btn" data-tool="charcoal" onclick="selectTool('charcoal')" title="فحم">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 20s1-1 4-1 5 2 8 2 4-1 4-1V4s-1 1-4 1-5-2-8-2-4 1-4 1v16z"/>
            </svg>
            <span>فحم</span>
          </button>
          <button class="tool-btn" data-tool="airbrush" onclick="selectTool('airbrush')" title="رش">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 3h14l1 9H4L5 3zM4 12h16M8 12v9M16 12v9M8 21h8"/>
            </svg>
            <span>رش</span>
          </button>
        </div>
      </div>

      <!-- مجموعة: أدوات التحديد -->
      <div class="tool-group" id="tg-select">
        <button class="tool-group-btn" onclick="toggleToolGroup('tg-select')" title="أدوات التحديد">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="6" height="6"/>
            <rect x="15" y="3" width="6" height="6"/>
            <rect x="3" y="15" width="6" height="6"/>
            <rect x="15" y="15" width="6" height="6"/>
          </svg>
          <span>تحديد</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn" data-tool="select-rect" onclick="selectTool('select-rect')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
            </svg>
            <span>تحديد مستطيل</span>
          </button>
          <button class="tool-btn" data-tool="select-circle" onclick="selectTool('select-circle')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="3 2">
              <circle cx="12" cy="12" r="9"/>
            </svg>
            <span>تحديد دائري</span>
          </button>
          <button class="tool-btn" data-tool="lasso" onclick="selectTool('lasso')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 3a9 9 0 0 0-9 9c0 5.1 4.2 9 9 9s9-3.9 9-9c0-1.8-.5-3.5-1.4-5"/>
            </svg>
            <span>تحديد حر</span>
          </button>
          <button class="tool-btn" data-tool="magic-wand" onclick="selectTool('magic-wand')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 4V2M15 16v-2M8 9H6M21 9h-2M17.8 11.8 19 13M15 9h0M13.2 6.2 12 5M17.8 6.2 19 5M13.2 11.8 12 13"/>
              <path d="M3 21l9-9"/>
            </svg>
            <span>العصا السحرية</span>
          </button>
          <button class="tool-btn" data-tool="move" onclick="selectTool('move')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="5 9 2 12 5 15"/>
              <polyline points="9 5 12 2 15 5"/>
              <polyline points="15 19 12 22 9 19"/>
              <polyline points="19 9 22 12 19 15"/>
              <line x1="2" y1="12" x2="22" y2="12"/>
              <line x1="12" y1="2" x2="12" y2="22"/>
            </svg>
            <span>تحريك</span>
          </button>
        </div>
      </div>

      <!-- مجموعة: أشكال هندسية -->
      <div class="tool-group" id="tg-shapes">
        <button class="tool-group-btn" onclick="toggleToolGroup('tg-shapes')" title="الأشكال">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="8" cy="8" r="4"/>
            <rect x="13" y="13" width="8" height="8"/>
          </svg>
          <span>الأشكال</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn" data-tool="line" onclick="selectTool('line')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="20" x2="20" y2="4"/></svg>
            <span>خط مستقيم</span>
          </button>
          <button class="tool-btn" data-tool="rect" onclick="selectTool('rect')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="5" width="18" height="14" rx="2"/></svg>
            <span>مستطيل</span>
          </button>
          <button class="tool-btn" data-tool="circle" onclick="selectTool('circle')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/></svg>
            <span>دائرة</span>
          </button>
          <button class="tool-btn" data-tool="triangle" onclick="selectTool('triangle')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 3 22 21 2 21"/></svg>
            <span>مثلث</span>
          </button>
          <button class="tool-btn" data-tool="polygon" onclick="selectTool('polygon')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 19.1 6.5 21.6 14.7 15.6 21.5 8.4 21.5 2.4 14.7 4.9 6.5"/></svg>
            <span>مضلع</span>
          </button>
          <button class="tool-btn" data-tool="star" onclick="selectTool('star')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            <span>نجمة</span>
          </button>
          <button class="tool-btn" data-tool="bezier" onclick="selectTool('bezier')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 20 Q8 4 12 12 Q16 20 20 4"/>
            </svg>
            <span>منحنى بيزييه</span>
          </button>
        </div>
      </div>

      <!-- مجموعة: أدوات الألوان -->
      <div class="tool-group" id="tg-color">
        <button class="tool-group-btn" onclick="toggleToolGroup('tg-color')" title="أدوات الألوان">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z"/>
            <path d="M12 2a10 10 0 0 1 0 20" fill="currentColor" opacity="0.3"/>
          </svg>
          <span>الألوان</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn" data-tool="fill" onclick="selectTool('fill')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" fill="currentColor"/>
            </svg>
            <span>دلو الطلاء</span>
          </button>
          <button class="tool-btn" data-tool="eyedropper" onclick="selectTool('eyedropper')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0l-2 2-1-1-1.5 1.5 1 1-5.06 5.06A2 2 0 0 0 4 15v3h3a2 2 0 0 0 1.41-.59L16 9.78l1 1 1.5-1.5-1-1 2-2a5.5 5.5 0 0 0 .34-7.17z"/>
            </svg>
            <span>قطارة الألوان</span>
          </button>
          <button class="tool-btn" data-tool="gradient" onclick="selectTool('gradient')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <defs><linearGradient id="tgr" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#fff"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
              <rect x="2" y="8" width="20" height="8" rx="2" stroke="currentColor"/>
            </svg>
            <span>تدرج لوني</span>
          </button>
        </div>
      </div>

      <!-- مجموعة: التحرير -->
      <div class="tool-group" id="tg-edit">
        <button class="tool-group-btn" onclick="toggleToolGroup('tg-edit')" title="التحرير">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
          </svg>
          <span>تحرير</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn" data-tool="eraser" onclick="selectTool('eraser')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 20H7L3 16l12-12 5 5-3.5 3.5"/>
              <path d="M6.6 9.6 10 13"/>
            </svg>
            <span>ممحاة</span>
          </button>
          <button class="tool-btn" data-tool="smudge" onclick="selectTool('smudge')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2L8.5 8.5l-3 3L3 14l3 3 2.5-2.5L14 20l6-6-6-12z"/>
            </svg>
            <span>تمويه/دهن</span>
          </button>
          <button class="tool-btn" data-tool="blur" onclick="selectTool('blur')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
            </svg>
            <span>ضبابية</span>
          </button>
          <button class="tool-btn" data-tool="sharpen" onclick="selectTool('sharpen')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 22 20 2 20"/>
              <line x1="12" y1="8" x2="12" y2="14"/>
            </svg>
            <span>حدة</span>
          </button>
          <button class="tool-btn" data-tool="clone" onclick="selectTool('clone')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="8" y="8" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            <span>استنساخ</span>
          </button>
        </div>
      </div>

      <!-- مجموعة: أدوات النص -->
      <div class="tool-group" id="tg-text">
        <button class="tool-group-btn" onclick="toggleToolGroup('tg-text')" title="النصوص">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="4 7 4 4 20 4 20 7"/>
            <line x1="9" y1="20" x2="15" y2="20"/>
            <line x1="12" y1="4" x2="12" y2="20"/>
          </svg>
          <span>نص</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn" data-tool="text" onclick="selectTool('text')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="4 7 4 4 20 4 20 7"/>
              <line x1="9" y1="20" x2="15" y2="20"/>
              <line x1="12" y1="4" x2="12" y2="20"/>
            </svg>
            <span>إضافة نص</span>
          </button>
        </div>
      </div>

      <!-- مجموعة: العرض -->
      <div class="tool-group" id="tg-view">
        <button class="tool-group-btn" onclick="toggleToolGroup('tg-view')" title="العرض">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          <span>عرض</span>
          <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </button>
        <div class="tool-group-dropdown">
          <button class="tool-btn" data-tool="zoom-in" onclick="zoomIn()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/>
            </svg>
            <span>تكبير</span>
          </button>
          <button class="tool-btn" data-tool="zoom-out" onclick="zoomOut()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/>
            </svg>
            <span>تصغير</span>
          </button>
          <button class="tool-btn" onclick="resetZoom()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
            </svg>
            <span>إعادة ضبط</span>
          </button>
          <button class="tool-btn" data-tool="hand" onclick="selectTool('hand')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/>
              <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/>
            </svg>
            <span>يد التحريك</span>
          </button>
        </div>
      </div>

    </div>
  </div>

  <div class="titlebar-left">
    <!-- تراجع وإعادة -->
    <button class="tb-btn" onclick="undoAction()" id="undoBtn" title="تراجع (Ctrl+Z)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="1 4 1 10 7 10"/>
        <path d="M3.51 15a9 9 0 1 0 .49-3.75"/>
      </svg>
    </button>
    <button class="tb-btn" onclick="redoAction()" id="redoBtn" title="إعادة (Ctrl+Y)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="23 4 23 10 17 10"/>
        <path d="M20.49 15a9 9 0 1 1-.49-3.75"/>
      </svg>
    </button>
    
    <div class="tb-divider"></div>
    
    <!-- حفظ وتصدير -->
    <button class="tb-btn" onclick="saveProject()" title="حفظ">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
        <polyline points="17 21 17 13 7 13 7 21"/>
        <polyline points="7 3 7 8 15 8"/>
      </svg>
    </button>
    <button class="tb-btn accent-btn" onclick="openExportPanel()" title="تصدير">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
      </svg>
    </button>
    
    <div class="tb-divider"></div>
    
    <!-- الإعدادات -->
    <button class="tb-btn" onclick="openSettings()" title="الإعدادات">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"/>
      </svg>
    </button>
    
    <!-- وضع ليلي -->
    <button class="tb-btn theme-toggle" onclick="toggleTheme()" id="themeBtn" title="الوضع الليلي">
      <svg id="moonIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
      <svg id="sunIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
    </button>
  </div>
</div>

<!-- جسم الاستوديو -->
<div class="studio-body">
  
  <!-- الشريط الجانبي الأيسر: أدوات الفرشاة والألوان -->
  <div class="sidebar-left" id="sidebarLeft">
    
    <!-- حجم الأداة -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg>
        <span>الحجم</span>
      </div>
      <div class="size-slider-wrap">
        <input type="range" id="brushSize" min="1" max="200" value="10" class="slider" oninput="updateBrushSize(this.value)">
        <span id="brushSizeVal">10</span>
      </div>
    </div>
    
    <!-- عتامة الأداة -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2a10 10 0 0 1 0 20" fill="currentColor" opacity="0.4"/></svg>
        <span>العتامة</span>
      </div>
      <div class="size-slider-wrap">
        <input type="range" id="opacity" min="1" max="100" value="100" class="slider" oninput="updateOpacity(this.value)">
        <span id="opacityVal">100%</span>
      </div>
    </div>
    
    <!-- نعومة الفرشاة -->
    <div class="sidebar-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M5 6h14M5 18h8"/></svg>
        <span>النعومة</span>
      </div>
      <div class="size-slider-wrap">
        <input type="range" id="smoothing" min="0" max="100" value="50" class="slider" oninput="updateSmoothing(this.value)">
        <span id="smoothingVal">50%</span>
      </div>
    </div>
    
    <div class="sidebar-divider"></div>
    
    <!-- فرش صفوان -->
    <div class="sidebar-section">
      <div class="section-header expandable" onclick="toggleSection('safwanBrushes')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L4.08 13.6a5.5 5.5 0 0 0 7.78 7.78l8.98-8.97a5.5 5.5 0 0 0 0-7.8z"/>
        </svg>
        <span>فرش صفوان المميزة</span>
        <svg class="section-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div id="safwanBrushes" class="brush-grid">
        <button class="brush-btn selected" onclick="selectBrush('safwan-pro', this)" title="صفوان برو">
          <div class="brush-preview safwan-pro"></div>
          <span>برو</span>
        </button>
        <button class="brush-btn" onclick="selectBrush('safwan-ink', this)" title="صفوان حبر">
          <div class="brush-preview safwan-ink"></div>
          <span>حبر</span>
        </button>
        <button class="brush-btn" onclick="selectBrush('safwan-watercolor', this)" title="صفوان مائي">
          <div class="brush-preview safwan-watercolor"></div>
          <span>مائي</span>
        </button>
        <button class="brush-btn" onclick="selectBrush('safwan-sketch', this)" title="صفوان سكتش">
          <div class="brush-preview safwan-sketch"></div>
          <span>سكتش</span>
        </button>
        <button class="brush-btn" onclick="selectBrush('safwan-glow', this)" title="صفوان توهج">
          <div class="brush-preview safwan-glow"></div>
          <span>توهج</span>
        </button>
      </div>
    </div>
    
    <!-- فرش احترافية -->
    <div class="sidebar-section">
      <div class="section-header expandable" onclick="toggleSection('proBrushes')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 20s1-1 4-1 5 2 8 2 4-1 4-1V4s-1 1-4 1-5-2-8-2-4 1-4 1v16z"/>
        </svg>
        <span>الفرش الاحترافية</span>
        <svg class="section-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div id="proBrushes" class="brush-list">
        <button class="brush-list-btn" onclick="selectBrush('round', this)">
          <div class="blb-icon round-brush"></div>
          <span>فرشاة مستديرة</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('flat', this)">
          <div class="blb-icon flat-brush"></div>
          <span>فرشاة مسطحة</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('fan', this)">
          <div class="blb-icon fan-brush"></div>
          <span>فرشاة مروحة</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('filbert', this)">
          <div class="blb-icon filbert-brush"></div>
          <span>فرشاة فيلبرت</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('charcoal', this)">
          <div class="blb-icon charcoal-brush"></div>
          <span>فحم</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('oil', this)">
          <div class="blb-icon oil-brush"></div>
          <span>زيتية</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('watercolor', this)">
          <div class="blb-icon watercolor-brush"></div>
          <span>مائية</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('splatter', this)">
          <div class="blb-icon splatter-brush"></div>
          <span>رش</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('texture', this)">
          <div class="blb-icon texture-brush"></div>
          <span>ملمس</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('soft', this)">
          <div class="blb-icon soft-brush"></div>
          <span>ناعمة</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('hard', this)">
          <div class="blb-icon hard-brush"></div>
          <span>صلبة</span>
        </button>
        <button class="brush-list-btn" onclick="selectBrush('calligraphy', this)">
          <div class="blb-icon calligraphy-brush"></div>
          <span>خط عربي</span>
        </button>
      </div>
    </div>
    
    <div class="sidebar-divider"></div>
    
    <!-- منتقي الألوان -->
    <div class="sidebar-section color-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/>
          <circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/>
          <circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/>
          <circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/>
          <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125 0-.922.703-1.688 1.648-1.688h1.949c3.008 0 5.63-2.51 5.63-5.625C22 6.747 17.5 2 12 2z"/>
        </svg>
        <span>الألوان</span>
      </div>
      
      <!-- لون الرسم والخلفية -->
      <div class="color-swap-area">
        <div class="color-swatch-wrap">
          <div class="color-swatch main-color" id="fgColor" style="background:#000000" onclick="openColorPicker('fg')" title="لون الرسم"></div>
          <div class="color-swatch bg-color" id="bgColorSwatch" style="background:#ffffff" onclick="openColorPicker('bg')" title="لون الخلفية"></div>
          <button class="swap-colors-btn" onclick="swapColors()" title="تبديل الألوان">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
          </button>
        </div>
        <div class="hex-input-wrap">
          <span>#</span>
          <input type="text" id="hexInput" value="000000" maxlength="6" oninput="setHexColor(this.value)" placeholder="000000">
        </div>
      </div>
      
      <!-- منتقي اللون الكامل -->
      <canvas id="colorWheelCanvas" width="160" height="160" class="color-wheel"></canvas>
      
      <!-- تدرج السطوع -->
      <div class="brightness-strip">
        <canvas id="colorStrip" width="160" height="16" class="color-strip"></canvas>
      </div>
      
      <!-- ألوان الحفظ -->
      <div class="saved-colors">
        <div class="sc-label">الألوان المحفوظة</div>
        <div id="savedColorsList" class="sc-grid"></div>
        <button class="add-color-btn" onclick="saveCurrentColor()" title="حفظ اللون الحالي">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </button>
      </div>
    </div>
    
    <!-- لوحة الألوان الكاملة -->
    <div class="sidebar-section">
      <div class="section-header expandable" onclick="toggleSection('fullPalette')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="5" height="5" rx="1" fill="currentColor" opacity="0.8"/>
          <rect x="10" y="3" width="5" height="5" rx="1" fill="currentColor" opacity="0.5"/>
          <rect x="17" y="3" width="5" height="5" rx="1" fill="currentColor" opacity="0.3"/>
        </svg>
        <span>لوحة الألوان الكاملة</span>
        <svg class="section-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div id="fullPalette" class="color-palette-grid" style="display:none">
        <!-- يتم توليدها بـ JS -->
      </div>
    </div>
    
  </div>

  <!-- المنطقة الرئيسية للرسم -->
  <div class="canvas-area" id="canvasArea">
    
    <!-- شريط التكبير -->
    <div class="zoom-bar">
      <button onclick="zoomOut()" title="تصغير">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
      <span id="zoomDisplay">100%</span>
      <button onclick="zoomIn()" title="تكبير">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
      <button onclick="resetZoom()" title="ضبط">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
      </button>
    </div>
    
    <!-- حاوية اللوحة -->
    <div class="canvas-container" id="canvasContainer">
      <div class="canvas-wrapper" id="canvasWrapper">
        <!-- خلفية شطرنج للشفافية -->
        <div class="canvas-checkered" id="canvasCheckered"></div>
        <!-- الكانفاسات (طبقات) -->
        <div id="canvasStack" class="canvas-stack">
          <canvas id="bgCanvas" class="drawing-canvas"></canvas>
          <canvas id="layer0" class="drawing-canvas active-canvas"></canvas>
          <canvas id="overlayCanvas" class="drawing-canvas overlay"></canvas>
          <canvas id="selectionCanvas" class="drawing-canvas selection-layer"></canvas>
        </div>
      </div>
    </div>
    
    <!-- شريط الإطارات للرسوم المتحركة -->
    <div class="timeline-bar" id="timelineBar" style="display:none">
      <div class="timeline-controls">
        <button class="tl-btn" onclick="addFrame()" title="إضافة فريم">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </button>
        <button class="tl-btn" onclick="duplicateFrame()" title="نسخ فريم">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="8" y="8" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        </button>
        <button class="tl-btn" onclick="deleteFrame()" title="حذف فريم">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        </button>
        <div class="tl-divider"></div>
        <button class="tl-btn play-btn" onclick="togglePlayAnimation()" id="playBtn" title="تشغيل">
          <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>
          <svg id="pauseIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
        </button>
        <div class="fps-control">
          <span>FPS:</span>
          <input type="number" id="fpsInput" value="12" min="1" max="60" onchange="updateFPS(this.value)">
        </div>
        <!-- مشاريع جاهزة -->
        <button class="tl-btn sample-btn" onclick="openSampleProjects()" title="مشاريع جاهزة">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="10" x2="12" y2="16"/></svg>
        </button>
      </div>
      
      <div class="frames-track" id="framesTrack">
        <!-- الإطارات تُولَّد بـ JS -->
      </div>
      
      <!-- عداد وقت الفريم -->
      <div class="timeline-right">
        <span class="frame-counter" id="frameCounter">1 / 1</span>
        <div class="frame-duration-wrap">
          <span>مدة:</span>
          <input type="number" id="frameDuration" value="83" min="16" max="5000" onchange="updateFrameDuration(this.value)">
          <span>ms</span>
        </div>
      </div>
    </div>
    
  </div>

  <!-- الشريط الجانبي الأيمن: الطبقات + المشروع -->
  <div class="sidebar-right" id="sidebarRight">
    
    <!-- معلومات المشروع -->
    <div class="sidebar-section project-info-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
        </svg>
        <span>المشروع</span>
      </div>
      <div class="project-details">
        <div class="pd-row"><span>النوع:</span><span id="pdType">ثابت</span></div>
        <div class="pd-row"><span>الحجم:</span><span id="pdSize">800 × 600</span></div>
        <div class="pd-row"><span>الطبقات:</span><span id="pdLayers">1</span></div>
      </div>
    </div>
    
    <!-- مرجع الرسم -->
    <div class="sidebar-section">
      <div class="section-header expandable" onclick="toggleSection('referenceSection')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
        <span>مرجع الرسم</span>
        <svg class="section-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div id="referenceSection" class="reference-content" style="display:none">
        <div class="ref-preview" id="refPreview">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
          <span>اضغط لرفع صورة مرجعية</span>
          <input type="file" id="refImageInput" accept="image/*" onchange="loadReferenceImage(event)">
        </div>
        <div class="ref-controls" id="refControls" style="display:none">
          <label>الشفافية: <span id="refOpacityVal">50%</span></label>
          <input type="range" id="refOpacity" min="5" max="100" value="50" class="slider" oninput="updateRefOpacity(this.value)">
          <div class="ref-btns">
            <button onclick="toggleRefLock()" id="refLockBtn" title="قفل المرجع">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </button>
            <button onclick="clearReference()" title="إزالة المرجع">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- نظام الطبقات -->
    <div class="sidebar-section layers-section">
      <div class="section-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 2 7 12 12 22 7 12 2"/>
          <polyline points="2 17 12 22 22 17"/>
          <polyline points="2 12 12 17 22 12"/>
        </svg>
        <span>الطبقات</span>
        <div class="layer-quick-actions">
          <button onclick="addLayer()" title="طبقة جديدة">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </button>
          <button onclick="deleteActiveLayer()" title="حذف الطبقة">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          </button>
          <button onclick="mergeAllLayers()" title="دمج الكل">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
          </button>
        </div>
      </div>
      
      <!-- وضع المزج -->
      <div class="blend-mode-wrap">
        <label>وضع المزج</label>
        <select id="blendModeSelect" onchange="setBlendMode(this.value)" class="blend-select">
          <option value="source-over">عادي</option>
          <option value="multiply">ضرب</option>
          <option value="screen">شاشة</option>
          <option value="overlay">تراكب</option>
          <option value="darken">تغميق</option>
          <option value="lighten">تفتيح</option>
          <option value="color-dodge">إضاءة لون</option>
          <option value="color-burn">حرق لون</option>
          <option value="hard-light">ضوء صلب</option>
          <option value="soft-light">ضوء ناعم</option>
          <option value="difference">فرق</option>
          <option value="exclusion">استثناء</option>
          <option value="hue">تدرج</option>
          <option value="saturation">تشبع</option>
          <option value="color">لون</option>
          <option value="luminosity">سطوع</option>
        </select>
      </div>
      
      <div id="layersList" class="layers-list">
        <!-- تُولَّد بـ JS -->
      </div>
    </div>
    
  </div>
</div>

<!-- نافذة الإعدادات -->
<div id="settingsPanel" class="panel-overlay" style="display:none">
  <div class="panel-box">
    <div class="panel-header">
      <h2>الإعدادات</h2>
      <button onclick="closePanel('settingsPanel')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="panel-body">
      <div class="settings-row">
        <span>الوضع الليلي</span>
        <label class="toggle-switch">
          <input type="checkbox" id="darkModeToggle" onchange="toggleTheme()">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="settings-row">
        <span>إظهار الشبكة</span>
        <label class="toggle-switch">
          <input type="checkbox" id="gridToggle" onchange="toggleGrid()">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="settings-row">
        <span>مسطرة القياس</span>
        <label class="toggle-switch">
          <input type="checkbox" id="rulerToggle" onchange="toggleRuler()">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="settings-row">
        <span>معاينة مصغرة</span>
        <label class="toggle-switch">
          <input type="checkbox" id="thumbnailToggle" onchange="toggleThumbnail()" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="settings-row">
        <span>ضغط القلم</span>
        <label class="toggle-switch">
          <input type="checkbox" id="pressureToggle" checked onchange="togglePressure()">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
  </div>
</div>

<!-- نافذة التصدير -->
<div id="exportPanel" class="panel-overlay" style="display:none">
  <div class="panel-box export-panel-box">
    <div class="panel-header">
      <h2>تصدير المشروع</h2>
      <button onclick="closePanel('exportPanel')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="panel-body">
      <div class="export-preview" id="exportPreview"></div>
      <div class="export-formats">
        <div class="ef-label">صيغ الصور الثابتة</div>
        <div class="ef-grid">
          <button class="ef-btn" onclick="exportAs('png')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            <span>PNG</span>
            <small>مع شفافية</small>
          </button>
          <button class="ef-btn" onclick="exportAs('jpeg')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            <span>JPEG</span>
            <small>جودة عالية</small>
          </button>
          <button class="ef-btn" onclick="exportAs('webp')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            <span>WebP</span>
            <small>حجم صغير</small>
          </button>
        </div>
        <div class="ef-label" id="animExportLabel" style="display:none">صيغ الرسوم المتحركة</div>
        <div class="ef-grid" id="animExportGrid" style="display:none">
          <button class="ef-btn" onclick="exportAnimation('gif')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>
            <span>GIF</span>
            <small>متحرك</small>
          </button>
          <button class="ef-btn" onclick="exportAnimation('webm')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>
            <span>WebM</span>
            <small>فيديو</small>
          </button>
        </div>
        <div class="jpeg-quality" id="jpegQualityWrap" style="display:none">
          <label>جودة JPEG: <span id="jpegQualityVal">90%</span></label>
          <input type="range" min="10" max="100" value="90" id="jpegQuality" class="slider" oninput="document.getElementById('jpegQualityVal').textContent=this.value+'%'">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- نافذة المشاريع الجاهزة -->
<div id="sampleProjectsPanel" class="panel-overlay" style="display:none">
  <div class="panel-box">
    <div class="panel-header">
      <h2>مشاريع جاهزة</h2>
      <button onclick="closePanel('sampleProjectsPanel')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="panel-body">
      <div class="sample-projects-grid">
        <div class="sp-card" onclick="loadSampleProject('fire')">
          <div class="sp-preview fire-preview">
            <canvas id="sampleFireCanvas" width="120" height="80"></canvas>
          </div>
          <div class="sp-info">
            <h3>نار متحركة</h3>
            <p>8 إطارات — خلفية بيضاء — نار احترافية</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- مؤشر تحميل -->
<div id="loadingOverlay" class="loading-overlay" style="display:none">
  <div class="loading-spinner">
    <svg viewBox="0 0 50 50">
      <circle cx="25" cy="25" r="20" fill="none" stroke="url(#spinGrad)" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 94.2">
        <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.8s" repeatCount="indefinite"/>
      </circle>
      <defs>
        <linearGradient id="spinGrad"><stop offset="0%" stop-color="#FF6B35"/><stop offset="100%" stop-color="#FFD700"/></linearGradient>
      </defs>
    </svg>
    <span>جارٍ المعالجة...</span>
  </div>
</div>

<script src="studio.js"></script>
</body>
</html>
