<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>الهروب من الشرطة - Police Chase 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            touch-action: none;
        }

        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
            cursor: grab;
        }

        #gameCanvas:active {
            cursor: grabbing;
        }

        /* شاشة البداية */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .logo-building {
            width: 300px;
            height: 400px;
            position: relative;
            margin-bottom: 40px;
            perspective: 1000px;
        }

        .building-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: rotateBuilding 6s infinite ease-in-out;
        }

        @keyframes rotateBuilding {
            0%, 100% { transform: rotateY(-15deg) rotateX(5deg); }
            50% { transform: rotateY(15deg) rotateX(-5deg); }
        }

        .building-face {
            position: absolute;
            background: linear-gradient(145deg, #1e3c72, #2a5298);
            border: 3px solid #4a90e2;
            box-shadow: 0 0 40px rgba(74, 144, 226, 0.6),
                        inset 0 0 60px rgba(74, 144, 226, 0.3);
        }

        .building-front {
            width: 200px;
            height: 350px;
            left: 50px;
            top: 25px;
            transform: translateZ(100px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, #1a2980, #26d0ce);
        }

        .building-side {
            width: 200px;
            height: 350px;
            left: 50px;
            top: 25px;
            transform: rotateY(90deg) translateZ(100px);
            background: linear-gradient(145deg, #134e5e, #71b280);
        }

        .building-text {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(45deg, #fff, #ffd700, #fff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            letter-spacing: 3px;
            animation: glowText 2s ease-in-out infinite;
            text-align: center;
            line-height: 1.2;
        }

        @keyframes glowText {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 10px gold); }
            50% { filter: brightness(1.3) drop-shadow(0 0 20px gold); }
        }

        .windows {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 20px;
            width: 100%;
        }

        .window {
            width: 30px;
            height: 40px;
            background: linear-gradient(180deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            animation: windowBlink 3s infinite ease-in-out;
            animation-delay: calc(var(--i) * 0.2s);
        }

        @keyframes windowBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .game-title {
            font-size: 56px;
            font-weight: 900;
            background: linear-gradient(90deg, #ff6b6b, #ee5a6f, #c44569);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 20px rgba(255, 107, 107, 0.4);
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .start-button {
            padding: 20px 60px;
            font-size: 28px;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .start-button:active {
            transform: translateY(0);
        }

        /* عناصر التحكم */
        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            align-items: flex-end;
            z-index: 100;
            pointer-events: none;
        }

        .joystick-container {
            position: relative;
            width: 160px;
            height: 160px;
            pointer-events: all;
        }

        .joystick-base {
            width: 160px;
            height: 160px;
            background: radial-gradient(circle, rgba(0,0,0,0.4), rgba(0,0,0,0.7));
            border-radius: 50%;
            position: relative;
            border: 4px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3),
                        inset 0 4px 16px rgba(255,255,255,0.1);
        }

        .joystick-stick {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(255,255,255,0.5);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5),
                        inset 0 2px 8px rgba(255,255,255,0.3);
            cursor: grab;
            transition: all 0.1s ease;
        }

        .joystick-stick:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(0.95);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            pointer-events: all;
        }

        .control-button {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.4);
            font-size: 18px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(0,0,0,0.3),
                        inset 0 2px 8px rgba(255,255,255,0.2);
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        #jumpBtn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        #boostBtn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .control-button:active {
            transform: scale(0.9);
            box-shadow: 0 3px 12px rgba(0,0,0,0.4),
                        inset 0 2px 8px rgba(0,0,0,0.2);
        }

        /* معلومات اللعبة */
        #gameInfo {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 100;
            pointer-events: none;
        }

        .info-box {
            background: rgba(0,0,0,0.6);
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            font-size: 20px;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        .speed-value {
            color: #4facfe;
            font-size: 28px;
        }

        .distance-value {
            color: #f5576c;
            font-size: 28px;
        }

        @media (max-width: 768px) {
            .logo-building {
                width: 250px;
                height: 330px;
            }

            .building-front {
                width: 160px;
                height: 280px;
            }

            .building-text {
                font-size: 36px;
            }

            .game-title {
                font-size: 42px;
            }

            .start-button {
                padding: 18px 50px;
                font-size: 24px;
            }

            .joystick-container {
                width: 140px;
                height: 140px;
            }

            .joystick-base {
                width: 140px;
                height: 140px;
            }

            .joystick-stick {
                width: 70px;
                height: 70px;
            }

            .control-button {
                width: 80px;
                height: 80px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <!-- شاشة البداية -->
    <div id="startScreen">
        <div class="logo-building">
            <div class="building-3d">
                <div class="building-face building-front">
                    <div class="building-text">برمجني</div>
                    <div class="windows">
                        <div class="window" style="--i: 1"></div>
                        <div class="window" style="--i: 2"></div>
                        <div class="window" style="--i: 3"></div>
                        <div class="window" style="--i: 4"></div>
                        <div class="window" style="--i: 5"></div>
                        <div class="window" style="--i: 6"></div>
                        <div class="window" style="--i: 7"></div>
                        <div class="window" style="--i: 8"></div>
                    </div>
                </div>
                <div class="building-face building-side"></div>
            </div>
        </div>
        <h1 class="game-title">الهروب من الشرطة</h1>
        <button class="start-button" onclick="startGame()">ابدأ اللعبة</button>
    </div>

    <!-- معلومات اللعبة -->
    <div id="gameInfo" style="display: none;">
        <div class="info-box">
            السرعة: <span class="speed-value" id="speedDisplay">0</span> كم/س
        </div>
        <div class="info-box">
            المسافة: <span class="distance-value" id="distanceDisplay">0</span> م
        </div>
    </div>

    <!-- عناصر التحكم -->
    <div id="controls" style="display: none;">
        <div class="joystick-container">
            <div class="joystick-base">
                <div class="joystick-stick" id="joystick"></div>
            </div>
        </div>
        <div class="action-buttons">
            <button class="control-button" id="jumpBtn">قفز</button>
            <button class="control-button" id="boostBtn">تسريع</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, policecars = [];
        let buildings = [], obstacles = [];
        let moveForward = 0, moveRight = 0;
        let playerVelocity = { x: 0, y: 0, z: 0 };
        let isJumping = false, isBoosting = false;
        let speed = 0, distance = 0;
        let joystickActive = false;
        let cameraAngleX = 0, cameraAngleY = Math.PI / 6;
        let isDragging = false, previousMouseX = 0, previousMouseY = 0;

        const GRAVITY = -0.5;
        const JUMP_FORCE = 15;
        const MOVE_SPEED = 0.8;
        const BOOST_MULTIPLIER = 2.5;
        const CITY_SIZE = 5000;
        const BUILDING_COUNT = 200;

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'flex';
            document.getElementById('controls').style.display = 'flex';
            init();
            animate();
        }

        function init() {
            // المشهد
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 100, 2000);

            // الكاميرا
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 3000);
            camera.position.set(0, 20, -30);

            // المُصيِّر
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('gameCanvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            // الإضاءة
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(100, 200, 100);
            sunLight.castShadow = true;
            sunLight.shadow.camera.left = -500;
            sunLight.shadow.camera.right = 500;
            sunLight.shadow.camera.top = 500;
            sunLight.shadow.camera.bottom = -500;
            sunLight.shadow.camera.far = 1000;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);

            // الأرضية
            const groundGeometry = new THREE.PlaneGeometry(CITY_SIZE, CITY_SIZE);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x2d2d2d,
                roughness: 0.8,
                metalness: 0.2
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // الشوارع
            createStreets();

            // اللاعب (كبسولة ملونة)
            const capsuleGeometry = new THREE.CylinderGeometry(3, 3, 8, 16);
            const capsuleMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xff1493,
                emissive: 0xff1493,
                emissiveIntensity: 0.3,
                roughness: 0.3,
                metalness: 0.7
            });
            player = new THREE.Mesh(capsuleGeometry, capsuleMaterial);
            player.position.set(0, 10, 0);
            player.castShadow = true;
            player.receiveShadow = true;
            scene.add(player);

            // إضافة خطوط للكبسولة
            const edgesGeometry = new THREE.EdgesGeometry(capsuleGeometry);
            const edgesMaterial = new THREE.LineBasicMaterial({ color: 0x00ffff, linewidth: 2 });
            const edges = new THREE.LineSegments(edgesGeometry, edgesMaterial);
            player.add(edges);

            // المدينة
            createCity();

            // سيارات الشرطة
            createPoliceCars(5);

            // أحداث التحكم
            setupControls();
            setupMouseControls();
        }

        function createStreets() {
            const streetMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x404040,
                roughness: 0.9
            });
            
            const streetWidth = 20;
            const streetSpacing = 120;

            for (let i = -20; i <= 20; i++) {
                // شوارع أفقية
                const streetH = new THREE.Mesh(
                    new THREE.PlaneGeometry(CITY_SIZE, streetWidth),
                    streetMaterial
                );
                streetH.rotation.x = -Math.PI / 2;
                streetH.position.set(0, 0.1, i * streetSpacing);
                streetH.receiveShadow = true;
                scene.add(streetH);

                // شوارع عمودية
                const streetV = new THREE.Mesh(
                    new THREE.PlaneGeometry(streetWidth, CITY_SIZE),
                    streetMaterial
                );
                streetV.rotation.x = -Math.PI / 2;
                streetV.position.set(i * streetSpacing, 0.1, 0);
                streetV.receiveShadow = true;
                scene.add(streetV);

                // خطوط الشارع
                if (i % 2 === 0) {
                    const lineMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
                    for (let j = -40; j <= 40; j++) {
                        const line = new THREE.Mesh(
                            new THREE.BoxGeometry(8, 0.2, 1),
                            lineMaterial
                        );
                        line.position.set(j * 50, 0.2, i * streetSpacing);
                        scene.add(line);
                    }
                }
            }
        }

        function createCity() {
            for (let i = 0; i < BUILDING_COUNT; i++) {
                const width = Math.random() * 30 + 20;
                const height = Math.random() * 150 + 50;
                const depth = Math.random() * 30 + 20;

                const buildingGeometry = new THREE.BoxGeometry(width, height, depth);
                const hue = Math.random();
                const buildingMaterial = new THREE.MeshStandardMaterial({ 
                    color: new THREE.Color().setHSL(hue, 0.4, 0.5),
                    roughness: 0.7,
                    metalness: 0.3
                });

                const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                
                let x, z;
                do {
                    x = (Math.random() - 0.5) * CITY_SIZE * 0.8;
                    z = (Math.random() - 0.5) * CITY_SIZE * 0.8;
                } while (Math.abs(x) < 50 && Math.abs(z) < 50);

                building.position.set(x, height / 2, z);
                building.castShadow = true;
                building.receiveShadow = true;
                
                buildings.push(building);
                obstacles.push(building);
                scene.add(building);

                // نوافذ
                const windowMaterial = new THREE.MeshBasicMaterial({ 
                    color: Math.random() > 0.3 ? 0xffff00 : 0x333333 
                });
                
                const windowsPerFloor = Math.floor(width / 5);
                const floors = Math.floor(height / 8);

                for (let f = 0; f < floors; f++) {
                    for (let w = 0; w < windowsPerFloor; w++) {
                        const windowGeometry = new THREE.BoxGeometry(2, 3, 0.5);
                        const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
                        windowMesh.position.set(
                            -width/2 + (w + 0.5) * (width / windowsPerFloor),
                            -height/2 + (f + 0.5) * (height / floors),
                            depth/2 + 0.3
                        );
                        building.add(windowMesh);
                    }
                }
            }
        }

        function createPoliceCars(count) {
            for (let i = 0; i < count; i++) {
                const carBody = new THREE.Mesh(
                    new THREE.BoxGeometry(6, 4, 12),
                    new THREE.MeshStandardMaterial({ 
                        color: 0x0000ff,
                        emissive: 0x0000ff,
                        emissiveIntensity: 0.2
                    })
                );
                
                const carTop = new THREE.Mesh(
                    new THREE.BoxGeometry(5, 2, 6),
                    new THREE.MeshStandardMaterial({ color: 0x4444ff })
                );
                carTop.position.y = 3;
                carBody.add(carTop);

                const lightGeometry = new THREE.BoxGeometry(2, 0.5, 2);
                const redLight = new THREE.Mesh(lightGeometry, new THREE.MeshBasicMaterial({ color: 0xff0000 }));
                const blueLight = new THREE.Mesh(lightGeometry, new THREE.MeshBasicMaterial({ color: 0x0000ff }));
                redLight.position.set(-1, 4, 0);
                blueLight.position.set(1, 4, 0);
                carBody.add(redLight);
                carBody.add(blueLight);

                carBody.position.set(
                    (Math.random() - 0.5) * 200,
                    2,
                    (Math.random() - 0.5) * 200 - 100
                );
                carBody.castShadow = true;
                
                policeCards.push({
                    mesh: carBody,
                    velocity: { x: 0, z: 0 }
                });
                
                scene.add(carBody);
            }
        }

        function setupControls() {
            const joystick = document.getElementById('joystick');
            const joystickBase = joystick.parentElement;
            const baseRect = joystickBase.getBoundingClientRect();
            const maxDistance = 40;

            function handleJoystickMove(clientX, clientY) {
                const deltaX = clientX - (baseRect.left + baseRect.width / 2);
                const deltaY = clientY - (baseRect.top + baseRect.height / 2);
                
                const distance = Math.min(Math.sqrt(deltaX * deltaX + deltaY * deltaY), maxDistance);
                const angle = Math.atan2(deltaY, deltaX);
                
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                joystick.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                
                moveRight = x / maxDistance;
                moveForward = -y / maxDistance;
            }

            function resetJoystick() {
                joystick.style.transform = 'translate(-50%, -50%)';
                moveRight = 0;
                moveForward = 0;
                joystickActive = false;
            }

            joystick.addEventListener('touchstart', (e) => {
                e.preventDefault();
                joystickActive = true;
            });

            joystick.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (joystickActive) {
                    handleJoystickMove(e.touches[0].clientX, e.touches[0].clientY);
                }
            });

            joystick.addEventListener('touchend', (e) => {
                e.preventDefault();
                resetJoystick();
            });

            // أزرار القفز والتسريع
            document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!isJumping && player.position.y <= 10.1) {
                    playerVelocity.y = JUMP_FORCE;
                    isJumping = true;
                }
            });

            document.getElementById('boostBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                isBoosting = true;
            });

            document.getElementById('boostBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                isBoosting = false;
            });
        }

        function setupMouseControls() {
            const canvas = document.getElementById('gameCanvas');

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMouseX = e.clientX;
                previousMouseY = e.clientY;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMouseX;
                    const deltaY = e.clientY - previousMouseY;

                    cameraAngleX -= deltaX * 0.005;
                    cameraAngleY -= deltaY * 0.005;

                    cameraAngleY = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, cameraAngleY));

                    previousMouseX = e.clientX;
                    previousMouseY = e.clientY;
                }
            });

            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });

            canvas.addEventListener('mouseleave', () => {
                isDragging = false;
            });

            // للأجهزة اللمسية
            canvas.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    isDragging = true;
                    previousMouseX = e.touches[0].clientX;
                    previousMouseY = e.touches[0].clientY;
                }
            });

            canvas.addEventListener('touchmove', (e) => {
                if (isDragging && e.touches.length === 1) {
                    const deltaX = e.touches[0].clientX - previousMouseX;
                    const deltaY = e.touches[0].clientY - previousMouseY;

                    cameraAngleX -= deltaX * 0.005;
                    cameraAngleY -= deltaY * 0.005;

                    cameraAngleY = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, cameraAngleY));

                    previousMouseX = e.touches[0].clientX;
                    previousMouseY = e.touches[0].clientY;
                }
            });

            canvas.addEventListener('touchend', () => {
                isDragging = false;
            });
        }

        function updatePlayer() {
            // الحركة
            const currentSpeed = isBoosting ? MOVE_SPEED * BOOST_MULTIPLIER : MOVE_SPEED;
            
            const moveAngle = cameraAngleX;
            const forwardX = Math.sin(moveAngle);
            const forwardZ = Math.cos(moveAngle);
            const rightX = Math.cos(moveAngle);
            const rightZ = -Math.sin(moveAngle);

            playerVelocity.x = (forwardX * moveForward + rightX * moveRight) * currentSpeed;
            playerVelocity.z = (forwardZ * moveForward + rightZ * moveRight) * currentSpeed;

            // الجاذبية والقفز
            playerVelocity.y += GRAVITY;
            player.position.y += playerVelocity.y;

            if (player.position.y <= 10) {
                player.position.y = 10;
                playerVelocity.y = 0;
                isJumping = false;
            }

            // تطبيق السرعة
            const newX = player.position.x + playerVelocity.x;
            const newZ = player.position.z + playerVelocity.z;

            // فحص التصادم مع المباني
            let collision = false;
            for (let building of obstacles) {
                const bBox = new THREE.Box3().setFromObject(building);
                const pBox = new THREE.Box3().setFromObject(player);
                pBox.min.x = newX - 3;
                pBox.max.x = newX + 3;
                pBox.min.z = newZ - 3;
                pBox.max.z = newZ + 3;

                if (bBox.intersectsBox(pBox)) {
                    collision = true;
                    break;
                }
            }

            if (!collision) {
                player.position.x = newX;
                player.position.z = newZ;
            }

            // حساب السرعة والمسافة
            speed = Math.sqrt(playerVelocity.x ** 2 + playerVelocity.z ** 2) * 10;
            distance += speed * 0.016;

            document.getElementById('speedDisplay').textContent = Math.round(speed);
            document.getElementById('distanceDisplay').textContent = Math.round(distance);
        }

        function updatePolice() {
            policeCards.forEach(car => {
                const dx = player.position.x - car.mesh.position.x;
                const dz = player.position.z - car.mesh.position.z;
                const distance = Math.sqrt(dx * dx + dz * dz);

                if (distance > 5) {
                    car.velocity.x = (dx / distance) * 0.6;
                    car.velocity.z = (dz / distance) * 0.6;

                    car.mesh.position.x += car.velocity.x;
                    car.mesh.position.z += car.velocity.z;

                    car.mesh.rotation.y = Math.atan2(dx, dz);
                }
            });
        }

        function updateCamera() {
            const distance = 35;
            const height = 15;

            const targetX = player.position.x - Math.sin(cameraAngleX) * distance * Math.cos(cameraAngleY);
            const targetY = player.position.y + height + Math.sin(cameraAngleY) * distance;
            const targetZ = player.position.z - Math.cos(cameraAngleX) * distance * Math.cos(cameraAngleY);

            camera.position.x = targetX;
            camera.position.y = targetY;
            camera.position.z = targetZ;

            camera.lookAt(player.position);
        }

        function animate() {
            requestAnimationFrame(animate);

            updatePlayer();
            updatePolice();
            updateCamera();

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
