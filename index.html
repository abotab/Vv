<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø§Ù„Ø´Ø±Ø·Ø© 3D - Police Chase 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }
        
        body {
            overflow: hidden;
            background: #000;
            color: white;
            touch-action: none;
        }
        
        canvas {
            display: block;
            outline: none;
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0a0a2a, #1a0033, #000033);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        .logo-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: 30px;
            perspective: 1000px;
        }
        
        .building-model {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) rotateY(0deg);
            width: 200px;
            height: 250px;
            animation: rotateBuilding 20s infinite linear;
        }
        
        @keyframes rotateBuilding {
            0% { transform: translateX(-50%) rotateY(0deg); }
            100% { transform: translateX(-50%) rotateY(360deg); }
        }
        
        .building-layer {
            position: absolute;
            width: 100%;
            border-radius: 10px;
        }
        
        .layer-top {
            height: 33.33%;
            top: 0;
            background: #ce1126;
            border: 3px solid white;
        }
        
        .layer-middle {
            height: 33.33%;
            top: 33.33%;
            background: white;
            border: 3px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .layer-bottom {
            height: 33.33%;
            top: 66.66%;
            background: black;
            border: 3px solid #ce1126;
        }
        
        .star {
            position: absolute;
            color: #00ff00;
            font-size: 20px;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .stars-top .star:nth-child(1) { top: 10%; left: 20%; }
        .stars-top .star:nth-child(2) { top: 10%; left: 50%; transform: translateX(-50%); }
        .stars-top .star:nth-child(3) { top: 10%; right: 20%; }
        
        .stars-bottom .star:nth-child(1) { bottom: 10%; left: 20%; }
        .stars-bottom .star:nth-child(2) { bottom: 10%; left: 50%; transform: translateX(-50%); }
        .stars-bottom .star:nth-child(3) { bottom: 10%; right: 20%; }
        
        .logo-text {
            color: black;
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .game-title {
            font-size: 42px;
            margin-bottom: 40px;
            text-align: center;
            background: linear-gradient(to right, #ff6b9d, #ff3333);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(255, 107, 157, 0.5);
            animation: titleGlow 2s infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 0 0 30px rgba(255, 107, 157, 0.5); }
            100% { text-shadow: 0 0 50px rgba(255, 107, 157, 0.8); }
        }
        
        .start-btn {
            padding: 18px 50px;
            font-size: 24px;
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(37, 117, 252, 0.4);
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(37, 117, 252, 0.6);
            background: linear-gradient(45deg, #2575fc, #6a11cb);
        }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
        #controls {
            position: fixed;
            bottom: 30px;
            left: 30px;
            right: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            pointer-events: none;
        }
        
        .joystick-container {
            width: 160px;
            height: 160px;
            position: relative;
            pointer-events: auto;
        }
        
        @media (max-width: 768px) {
            .joystick-container {
                width: 140px;
                height: 140px;
            }
        }
        
        .joystick-outer {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            position: absolute;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .joystick-inner {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #8e2de2, #4a00e0);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: move;
            box-shadow: 0 0 20px rgba(142, 45, 226, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.1s;
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            pointer-events: auto;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                gap: 15px;
            }
        }
        
        .action-btn {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .action-btn {
                width: 80px;
                height: 80px;
                font-size: 16px;
            }
        }
        
        .action-btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }
        
        .action-btn:active::after {
            animation: shine 0.5s;
        }
        
        @keyframes shine {
            100% { transform: translateX(100%); }
        }
        
        .jump-btn {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }
        
        .boost-btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        .info-panel {
            position: fixed;
            top: 20px;
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 768px) {
            .info-panel {
                padding: 10px 15px;
                font-size: 18px;
            }
        }
        
        #speedPanel {
            left: 20px;
        }
        
        #distancePanel {
            right: 20px;
        }
        
        .speed-value {
            color: #4facfe;
            text-shadow: 0 0 10px #4facfe;
        }
        
        .distance-value {
            color: #ff1493;
            text-shadow: 0 0 10px #ff1493;
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
        #endScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .end-container {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #ff3333;
            box-shadow: 0 0 50px rgba(255, 51, 51, 0.5);
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: borderGlow 2s infinite alternate;
        }
        
        @keyframes borderGlow {
            0% { border-color: #ff3333; box-shadow: 0 0 50px rgba(255, 51, 51, 0.5); }
            100% { border-color: #ff6b9d; box-shadow: 0 0 70px rgba(255, 107, 157, 0.7); }
        }
        
        .end-title {
            color: #ff3333;
            font-size: 48px;
            margin-bottom: 30px;
            text-shadow: 0 0 20px #ff3333;
        }
        
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 22px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            color: #4facfe;
            font-weight: bold;
        }
        
        .restart-btn {
            padding: 18px 40px;
            font-size: 22px;
            background: linear-gradient(45deg, #8e2de2, #4a00e0);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .restart-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(142, 45, 226, 0.6);
        }
        
        /* ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… */
        .instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 1001;
            display: none;
            backdrop-filter: blur(10px);
            border: 2px solid #4facfe;
            max-width: 400px;
            width: 90%;
        }
        
        .instructions h3 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .instructions p {
            margin: 10px 0;
            line-height: 1.6;
            color: #ccc;
        }
        
        .close-btn {
            margin-top: 20px;
            padding: 10px 25px;
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© */
        .speed-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(79, 172, 254, 0.1) 100%);
            transition: opacity 0.3s;
        }
        
        .jump-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            background: radial-gradient(circle at center, transparent 30%, rgba(245, 87, 108, 0.1) 70%);
            transition: opacity 0.3s;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1002;
        }
        
        .loading-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: #4facfe;
        }
        
        .loading-bar {
            width: 300px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div id="startScreen">
        <div class="logo-container">
            <div class="building-model">
                <div class="building-layer layer-top">
                    <div class="stars-top">
                        <div class="star">â˜…</div>
                        <div class="star">â˜…</div>
                        <div class="star">â˜…</div>
                    </div>
                </div>
                <div class="building-layer layer-middle">
                    <div class="logo-text">Ø¨Ø±Ù…Ø¬Ù†ÙŠ</div>
                </div>
                <div class="building-layer layer-bottom">
                    <div class="stars-bottom">
                        <div class="star">â˜…</div>
                        <div class="star">â˜…</div>
                        <div class="star">â˜…</div>
                    </div>
                </div>
            </div>
        </div>
        
        <h1 class="game-title">ğŸš“ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø§Ù„Ø´Ø±Ø·Ø© 3D ğŸš“</h1>
        
        <button id="startBtn" class="start-btn">ğŸ® Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© ğŸ®</button>
        
        <div style="margin-top: 40px; color: #aaa; text-align: center; max-width: 500px; padding: 0 20px;">
            <p>ğŸ¯ Ø§Ø³ØªØ®Ø¯Ù… Ø¹ØµØ§ Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ø­Ø±ÙƒØ© | âš¡ Ø§Ø¶ØºØ· ØªØ³Ø±ÙŠØ¹ Ù„Ù„Ø¥Ø³Ø±Ø§Ø¹ | â¬†ï¸ Ø§Ø¶ØºØ· Ù‚ÙØ² Ù„Ù„Ù‚ÙØ²</p>
            <p>ğŸ“± Ø§Ø³Ø­Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ | ğŸƒâ€â™‚ï¸ Ø§Ù‡Ø±Ø¨ Ù…Ù† Ø§Ù„Ø´Ø±Ø·Ø©!</p>
        </div>
    </div>
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
    <div class="info-panel" id="speedPanel">
        Ø§Ù„Ø³Ø±Ø¹Ø©: <span class="speed-value" id="speedValue">0</span> ÙƒÙ…/Ø³
    </div>
    
    <div class="info-panel" id="distancePanel">
        Ø§Ù„Ù…Ø³Ø§ÙØ©: <span class="distance-value" id="distanceValue">0</span> Ù…
    </div>
    
    <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="controls">
        <div class="joystick-container">
            <div class="joystick-outer"></div>
            <div class="joystick-inner" id="joystick"></div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn jump-btn" id="jumpBtn">Ù‚ÙØ²</button>
            <button class="action-btn boost-btn" id="boostBtn">ØªØ³Ø±ÙŠØ¹</button>
        </div>
    </div>
    
    <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© -->
    <div class="speed-effect" id="speedEffect"></div>
    <div class="jump-effect" id="jumpEffect"></div>
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
    <div id="endScreen">
        <div class="end-container">
            <h1 class="end-title">ØªÙ… Ø§Ù„Ù‚Ø¨Ø¶ Ø¹Ù„ÙŠÙƒ!</h1>
            
            <div class="stats-container">
                <div class="stat-item">
                    <span>ğŸ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</span>
                    <span class="stat-value" id="finalScore">0</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ“ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©:</span>
                    <span class="stat-value" id="finalDistance">0</span> Ù…
                </div>
                <div class="stat-item">
                    <span>â±ï¸ Ø§Ù„ÙˆÙ‚Øª:</span>
                    <span class="stat-value" id="finalTime">0</span> Ø«Ø§Ù†ÙŠØ©
                </div>
            </div>
            
            <button id="restartBtn" class="restart-btn">ğŸ”„ Ø§Ø¨Ø¯Ø£ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„</button>
        </div>
    </div>
    
    <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="instructions" class="instructions">
        <h3>ğŸ® ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨:</h3>
        <p>1. Ø§Ø³ØªØ®Ø¯Ù… Ø¹ØµØ§ Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ø­Ø±ÙƒØ© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª</p>
        <p>2. Ø§Ø¶ØºØ· Ø²Ø± "Ù‚ÙØ²" Ù„Ù„Ù‚ÙØ² Ø¹Ø§Ù„ÙŠØ§Ù‹</p>
        <p>3. Ø§Ø¶ØºØ· Ø²Ø± "ØªØ³Ø±ÙŠØ¹" Ù„Ù„Ø¥Ø³Ø±Ø§Ø¹ (Ù…Ø­Ø¯ÙˆØ¯Ø© Ø§Ù„ÙˆÙ‚Øª)</p>
        <p>4. Ø§Ø³Ø­Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø­ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨</p>
        <p>5. Ø§Ù‡Ø±Ø¨ Ù…Ù† Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø·Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡!</p>
        <p>6. Ø­Ø§ÙˆÙ„ Ù‚Ø·Ø¹ Ø£Ø·ÙˆÙ„ Ù…Ø³Ø§ÙØ© Ù…Ù…ÙƒÙ†Ø©</p>
        <button id="closeInstructions" class="close-btn">Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª!</button>
    </div>
    
    <!-- Canvas Ù„Ù„Ø¹Ø¨Ø© -->
    <canvas id="gameCanvas"></canvas>
    
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let scene, camera, renderer;
        let player, policeCars = [];
        let buildings = [];
        let streets = [];
        let specialBuilding;
        let clock = new THREE.Clock();
        let joystickActive = false;
        let joystickDirection = { x: 0, y: 0 };
        let gameStarted = false;
        let gameEnded = false;
        let distance = 0;
        let startTime = 0;
        let speed = 0;
        let boostActive = false;
        let boostTime = 0;
        const BOOST_DURATION = 3;
        const BOOST_COOLDOWN = 5;
        let canBoost = true;
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const startScreen = document.getElementById('startScreen');
        const loadingScreen = document.getElementById('loadingScreen');
        const loadingProgress = document.getElementById('loadingProgress');
        const startBtn = document.getElementById('startBtn');
        const speedValue = document.getElementById('speedValue');
        const distanceValue = document.getElementById('distanceValue');
        const joystick = document.getElementById('joystick');
        const jumpBtn = document.getElementById('jumpBtn');
        const boostBtn = document.getElementById('boostBtn');
        const endScreen = document.getElementById('endScreen');
        const finalScore = document.getElementById('finalScore');
        const finalDistance = document.getElementById('finalDistance');
        const finalTime = document.getElementById('finalTime');
        const restartBtn = document.getElementById('restartBtn');
        const speedEffect = document.getElementById('speedEffect');
        const jumpEffect = document.getElementById('jumpEffect');
        const instructions = document.getElementById('instructions');
        const closeInstructions = document.getElementById('closeInstructions');
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª
        class GameAudio {
            constructor() {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.gainNode = this.audioContext.createGain();
                this.gainNode.connect(this.audioContext.destination);
                this.gainNode.gain.value = 0.1;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
                this.createBackgroundMusic();
            }
            
            createBackgroundMusic() {
                const notes = [261.63, 293.66, 329.63, 349.23, 392.00, 349.23, 329.63, 293.66]; // C, D, E, F, G, F, E, D
                let currentNote = 0;
                
                setInterval(() => {
                    if (gameStarted && !gameEnded) {
                        const oscillator = this.audioContext.createOscillator();
                        oscillator.connect(this.gainNode);
                        oscillator.frequency.value = notes[currentNote];
                        oscillator.type = 'sine';
                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 0.5);
                        
                        currentNote = (currentNote + 1) % notes.length;
                    }
                }, 500);
            }
            
            playJumpSound() {
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = 523.25; // C5
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.5);
            }
            
            playBoostSound() {
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = 659.25; // E5
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.3);
            }
            
            playCrashSound() {
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.5);
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.5);
            }
            
            playPoliceSiren() {
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.value = 0.05;
                
                oscillator.start();
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ 0.3 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    oscillator.stop();
                }, 300);
            }
        }
        
        let gameAudio;
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function simulateLoading() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        startScreen.style.display = 'flex';
                    }, 500);
                }
                loadingProgress.style.width = `${progress}%`;
            }, 100);
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function init() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ù‡Ø¯
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x000000, 500, 2000);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 3000);
            camera.position.set(0, 20, 40);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙØµÙŠÙÙ‘Ø±
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('gameCanvas'),
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            
            const sunLight = new THREE.DirectionalLight(0xffffff, 0.9);
            sunLight.position.set(200, 300, 200);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 1024;
            sunLight.shadow.mapSize.height = 1024;
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 2000;
            sunLight.shadow.camera.left = -1000;
            sunLight.shadow.camera.right = 1000;
            sunLight.shadow.camera.top = 1000;
            sunLight.shadow.camera.bottom = -1000;
            scene.add(sunLight);
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
            createCity();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨
            createPlayer();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø·Ø©
            createPoliceCars();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ­ÙƒÙ…
            initControls();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª
            gameAudio = new GameAudio();
            
            // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            animate();
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
            setTimeout(() => {
                instructions.style.display = 'block';
            }, 1000);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
        function createCity() {
            const citySize = 3000;
            const streetWidth = 20;
            const buildingSpacing = 120;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹
            for (let x = -citySize/2; x <= citySize/2; x += buildingSpacing) {
                const streetGeometry = new THREE.PlaneGeometry(citySize, streetWidth);
                const streetMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x404040,
                    roughness: 0.9,
                    metalness: 0.1
                });
                const street = new THREE.Mesh(streetGeometry, streetMaterial);
                street.rotation.x = -Math.PI / 2;
                street.position.set(0, 0.1, x);
                street.receiveShadow = true;
                scene.add(street);
                streets.push(street);
                
                // Ø®Ø·ÙˆØ· Ø§Ù„Ø´ÙˆØ§Ø±Ø¹
                for (let z = -citySize/2 + 100; z <= citySize/2 - 100; z += 40) {
                    const lineGeometry = new THREE.PlaneGeometry(streetWidth - 2, 3);
                    const lineMaterial = new THREE.MeshStandardMaterial({ 
                        color: 0xffff00,
                        emissive: 0xffff00,
                        emissiveIntensity: 0.3
                    });
                    const line = new THREE.Mesh(lineGeometry, lineMaterial);
                    line.rotation.x = -Math.PI / 2;
                    line.position.set(z, 0.11, x);
                    scene.add(line);
                }
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ
            const buildingCount = 120;
            for (let i = 0; i < buildingCount; i++) {
                const width = Math.random() * 40 + 20;
                const depth = Math.random() * 40 + 20;
                const height = Math.random() * 150 + 50;
                
                const buildingGeometry = new THREE.BoxGeometry(width, height, depth);
                const hue = Math.random();
                const buildingMaterial = new THREE.MeshStandardMaterial({ 
                    color: new THREE.Color().setHSL(hue, 0.7, 0.5),
                    roughness: 0.8,
                    metalness: 0.2
                });
                
                const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                
                // ÙˆØ¶Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ù…Ø¨Ù†Ù‰
                const x = Math.floor(Math.random() * 25) * buildingSpacing * (Math.random() > 0.5 ? 1 : -1);
                const z = Math.floor(Math.random() * 25) * buildingSpacing * (Math.random() > 0.5 ? 1 : -1);
                
                building.position.set(x, height/2, z);
                building.castShadow = true;
                building.receiveShadow = true;
                
                scene.add(building);
                buildings.push(building);
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ÙˆØ§ÙØ°
                const windowRows = Math.floor(height / 20);
                const windowCols = Math.floor(width / 10);
                
                for (let row = 0; row < windowRows; row++) {
                    for (let col = 0; col < windowCols; col++) {
                        const windowGeometry = new THREE.PlaneGeometry(3, 5);
                        const windowMaterial = new THREE.MeshBasicMaterial({ 
                            color: Math.random() > 0.7 ? 0xffff00 : 0x333333,
                            transparent: true,
                            opacity: 0.8
                        });
                        const window = new THREE.Mesh(windowGeometry, windowMaterial);
                        
                        // ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¨Ù†Ù‰
                        window.position.set(
                            x - width/2 + 0.1,
                            row * 20 - height/2 + 15,
                            z + depth/2 - 0.1
                        );
                        
                        scene.add(window);
                    }
                }
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ø§Ø±Ø© "Ø¨Ø±Ù…Ø¬Ù†ÙŠ" Ø§Ù„Ø®Ø§ØµØ©
            createSpecialBuilding();
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ø§Ø±Ø© Ø¨Ø±Ù…Ø¬Ù†ÙŠ
        function createSpecialBuilding() {
            const height = 250;
            
            // Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ (Ø­Ù…Ø±Ø§Ø¡)
            const topGeometry = new THREE.BoxGeometry(60, height/3, 60);
            const topMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xce1126,
                roughness: 0.7,
                metalness: 0.3
            });
            const topLayer = new THREE.Mesh(topGeometry, topMaterial);
            topLayer.position.set(0, height/3, 150);
            topLayer.castShadow = true;
            topLayer.receiveShadow = true;
            scene.add(topLayer);
            
            // Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ Ù„Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¹Ù„ÙŠØ§
            for (let i = 0; i < 3; i++) {
                const starGeometry = new THREE.SphereGeometry(2, 8, 8);
                const starMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x00ff00,
                    emissive: 0x00ff00,
                    emissiveIntensity: 0.5
                });
                const star = new THREE.Mesh(starGeometry, starMaterial);
                star.position.set(-15 + i * 15, height/3, 150 + 31);
                scene.add(star);
            }
            
            // Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„ÙˆØ³Ø·Ù‰ (Ø¨ÙŠØ¶Ø§Ø¡)
            const middleGeometry = new THREE.BoxGeometry(60, height/3, 60);
            const middleMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xffffff,
                roughness: 0.7,
                metalness: 0.3
            });
            const middleLayer = new THREE.Mesh(middleGeometry, middleMaterial);
            middleLayer.position.set(0, 0, 150);
            middleLayer.castShadow = true;
            middleLayer.receiveShadow = true;
            scene.add(middleLayer);
            
            // Ù†Øµ "Ø¨Ø±Ù…Ø¬Ù†ÙŠ"
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 64;
            const context = canvas.getContext('2d');
            context.fillStyle = 'black';
            context.font = 'bold 48px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText('Ø¨Ø±Ù…Ø¬Ù†ÙŠ', 128, 32);
            
            const texture = new THREE.CanvasTexture(canvas);
            const textMaterial = new THREE.MeshBasicMaterial({ 
                map: texture,
                transparent: true,
                side: THREE.DoubleSide
            });
            const textGeometry = new THREE.PlaneGeometry(40, 15);
            const text = new THREE.Mesh(textGeometry, textMaterial);
            text.position.set(0, 0, 150 + 31);
            scene.add(text);
            
            // Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø³ÙÙ„Ù‰ (Ø³ÙˆØ¯Ø§Ø¡)
            const bottomGeometry = new THREE.BoxGeometry(60, height/3, 60);
            const bottomMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x000000,
                roughness: 0.7,
                metalness: 0.3
            });
            const bottomLayer = new THREE.Mesh(bottomGeometry, bottomMaterial);
            bottomLayer.position.set(0, -height/3, 150);
            bottomLayer.castShadow = true;
            bottomLayer.receiveShadow = true;
            scene.add(bottomLayer);
            
            // Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ Ù„Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø³ÙÙ„Ù‰
            for (let i = 0; i < 3; i++) {
                const starGeometry = new THREE.SphereGeometry(2, 8, 8);
                const starMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x00ff00,
                    emissive: 0x00ff00,
                    emissiveIntensity: 0.5
                });
                const star = new THREE.Mesh(starGeometry, starMaterial);
                star.position.set(-15 + i * 15, -height/3, 150 + 31);
                scene.add(star);
            }
            
            specialBuilding = { topLayer, middleLayer, bottomLayer, text };
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨
        function createPlayer() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø´ÙƒÙ„ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©
            const capsuleGeometry = new THREE.CapsuleGeometry(3, 4, 8, 16);
            const playerMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xff1493,
                emissive: 0xff1493,
                emissiveIntensity: 0.4,
                roughness: 0.2,
                metalness: 0.8
            });
            
            player = new THREE.Mesh(capsuleGeometry, playerMaterial);
            player.position.set(0, 5, 0);
            player.castShadow = true;
            player.receiveShadow = true;
            scene.add(player);
            
            // Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ· ØªØ­Ø¯ÙŠØ¯
            const wireframeGeometry = new THREE.CapsuleGeometry(3.1, 4.2, 8, 16);
            const wireframeMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x00ffff,
                wireframe: true,
                transparent: true,
                opacity: 0.5
            });
            const wireframe = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
            player.add(wireframe);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø·Ø©
        function createPoliceCars() {
            const policePositions = [
                { x: 100, z: 100 },
                { x: -100, z: 100 },
                { x: 100, z: -100 },
                { x: -100, z: -100 }
            ];
            
            for (let i = 0; i < 4; i++) {
                // Ø¬Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                const carGeometry = new THREE.BoxGeometry(8, 3, 4);
                const carMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x0000ff,
                    roughness: 0.5,
                    metalness: 0.5
                });
                const car = new THREE.Mesh(carGeometry, carMaterial);
                car.position.set(policePositions[i].x, 2, policePositions[i].z);
                car.castShadow = true;
                car.receiveShadow = true;
                
                // Ø³Ù‚Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                const roofGeometry = new THREE.BoxGeometry(5, 1, 3);
                const roof = new THREE.Mesh(roofGeometry, carMaterial);
                roof.position.y = 2.5;
                car.add(roof);
                
                // Ø£Ø¶ÙˆØ§Ø¡ Ø§Ù„Ø¥Ù†Ø°Ø§Ø±
                const lightGeometry = new THREE.BoxGeometry(1, 0.5, 0.5);
                const redLightMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xff0000,
                    emissive: 0xff0000,
                    emissiveIntensity: 1
                });
                const blueLightMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x0000ff,
                    emissive: 0x0000ff,
                    emissiveIntensity: 1
                });
                
                const redLight = new THREE.Mesh(lightGeometry, redLightMaterial);
                const blueLight = new THREE.Mesh(lightGeometry, blueLightMaterial);
                
                redLight.position.set(0, 3, -1);
                blueLight.position.set(0, 3, 1);
                
                car.add(redLight);
                car.add(blueLight);
                
                scene.add(car);
                policeCars.push({
                    mesh: car,
                    redLight: redLight,
                    blueLight: blueLight,
                    speed: 1.2
                });
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function initControls() {
            // Ø¹ØµØ§ Ø§Ù„ØªØ­ÙƒÙ…
            let joystickStartX = 0;
            let joystickStartY = 0;
            let joystickCurrentX = 0;
            let joystickCurrentY = 0;
            
            joystick.addEventListener('touchstart', handleJoystickStart);
            joystick.addEventListener('mousedown', handleJoystickStart);
            
            function handleJoystickStart(e) {
                e.preventDefault();
                joystickActive = true;
                const rect = joystick.parentElement.getBoundingClientRect();
                joystickStartX = rect.left + rect.width / 2;
                joystickStartY = rect.top + rect.height / 2;
                
                document.addEventListener('touchmove', handleJoystickMove);
                document.addEventListener('mousemove', handleJoystickMove);
                document.addEventListener('touchend', handleJoystickEnd);
                document.addEventListener('mouseup', handleJoystickEnd);
            }
            
            function handleJoystickMove(e) {
                if (!joystickActive) return;
                
                e.preventDefault();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                
                joystickCurrentX = clientX - joystickStartX;
                joystickCurrentY = clientY - joystickStartY;
                
                // Ø§Ù„Ø­Ø¯ Ù…Ù† Ø­Ø±ÙƒØ© Ø§Ù„Ø¹ØµØ§
                const maxDistance = 40;
                const distance = Math.sqrt(joystickCurrentX * joystickCurrentX + joystickCurrentY * joystickCurrentY);
                
                if (distance > maxDistance) {
                    joystickCurrentX = (joystickCurrentX / distance) * maxDistance;
                    joystickCurrentY = (joystickCurrentY / distance) * maxDistance;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹ØµØ§
                joystick.style.transform = `translate(calc(-50% + ${joystickCurrentX}px), calc(-50% + ${joystickCurrentY}px))`;
                
                // ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­Ø±ÙƒØ©
                joystickDirection.x = joystickCurrentX / maxDistance;
                joystickDirection.y = joystickCurrentY / maxDistance;
            }
            
            function handleJoystickEnd() {
                joystickActive = false;
                joystick.style.transform = 'translate(-50%, -50%)';
                joystickDirection.x = 0;
                joystickDirection.y = 0;
                
                document.removeEventListener('touchmove', handleJoystickMove);
                document.removeEventListener('mousemove', handleJoystickMove);
                document.removeEventListener('touchend', handleJoystickEnd);
                document.removeEventListener('mouseup', handleJoystickEnd);
            }
            
            // Ø²Ø± Ø§Ù„Ù‚ÙØ²
            jumpBtn.addEventListener('touchstart', () => jump());
            jumpBtn.addEventListener('mousedown', () => jump());
            
            // Ø²Ø± Ø§Ù„ØªØ³Ø±ÙŠØ¹
            boostBtn.addEventListener('touchstart', () => activateBoost());
            boostBtn.addEventListener('mousedown', () => activateBoost());
            
            // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            let cameraControlActive = false;
            let lastMouseX = 0;
            let lastMouseY = 0;
            let cameraAngleX = 0;
            let cameraAngleY = 20;
            let cameraDistance = 40;
            let cameraHeight = 20;
            
            document.addEventListener('mousedown', (e) => {
                if (e.target === joystick || e.target === jumpBtn || e.target === boostBtn) return;
                cameraControlActive = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            });
            
            document.addEventListener('touchstart', (e) => {
                if (e.target === joystick || e.target === jumpBtn || e.target === boostBtn) return;
                cameraControlActive = true;
                lastMouseX = e.touches[0].clientX;
                lastMouseY = e.touches[0].clientY;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!cameraControlActive || !gameStarted || gameEnded) return;
                
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                cameraAngleX += deltaX * 0.5;
                cameraAngleY = Math.max(-90, Math.min(90, cameraAngleY + deltaY * 0.5));
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!cameraControlActive || !gameStarted || gameEnded) return;
                
                const deltaX = e.touches[0].clientX - lastMouseX;
                const deltaY = e.touches[0].clientY - lastMouseY;
                
                cameraAngleX += deltaX * 0.5;
                cameraAngleY = Math.max(-90, Math.min(90, cameraAngleY + deltaY * 0.5));
                
                lastMouseX = e.touches[0].clientX;
                lastMouseY = e.touches[0].clientY;
            });
            
            document.addEventListener('mouseup', () => {
                cameraControlActive = false;
            });
            
            document.addEventListener('touchend', () => {
                cameraControlActive = false;
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙŠ ÙƒÙ„ Ø¥Ø·Ø§Ø±
            function updateCamera() {
                if (!player || !gameStarted) return;
                
                const angleXRad = (cameraAngleX * Math.PI) / 180;
                const angleYRad = (cameraAngleY * Math.PI) / 180;
                
                const targetX = player.position.x;
                const targetY = player.position.y + cameraHeight;
                const targetZ = player.position.z;
                
                const offsetX = cameraDistance * Math.cos(angleYRad) * Math.sin(angleXRad);
                const offsetY = cameraDistance * Math.sin(angleYRad);
                const offsetZ = cameraDistance * Math.cos(angleYRad) * Math.cos(angleXRad);
                
                camera.position.x = targetX + offsetX;
                camera.position.y = targetY + offsetY;
                camera.position.z = targetZ + offsetZ;
                
                camera.lookAt(targetX, targetY, targetZ);
            }
            
            window.updateCamera = updateCamera;
            
            // Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            startBtn.addEventListener('click', () => {
                startScreen.style.opacity = '0';
                setTimeout(() => {
                    startScreen.style.display = 'none';
                    gameStarted = true;
                    startTime = Date.now();
                }, 500);
            });
            
            // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            restartBtn.addEventListener('click', () => {
                location.reload();
            });
            
            // Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
            closeInstructions.addEventListener('click', () => {
                instructions.style.display = 'none';
            });
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù‚ÙØ²
        function jump() {
            if (!gameStarted || gameEnded) return;
            
            player.userData.velocityY = player.userData.velocityY || 0;
            player.userData.velocityY = 18;
            gameAudio.playJumpSound();
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ²
            jumpEffect.style.opacity = '0.5';
            setTimeout(() => {
                jumpEffect.style.opacity = '0';
            }, 300);
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ³Ø±ÙŠØ¹
        function activateBoost() {
            if (!gameStarted || gameEnded || !canBoost) return;
            
            boostActive = true;
            boostTime = BOOST_DURATION;
            canBoost = false;
            gameAudio.playBoostSound();
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ³Ø±ÙŠØ¹
            speedEffect.style.opacity = '0.3';
            
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
            boostBtn.disabled = true;
            boostBtn.style.opacity = '0.5';
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            setTimeout(() => {
                canBoost = true;
                boostBtn.disabled = false;
                boostBtn.style.opacity = '1';
            }, BOOST_COOLDOWN * 1000);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡
        function updatePhysics(deltaTime) {
            if (!gameStarted || gameEnded) return;
            
            // Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
            player.userData.velocityY = player.userData.velocityY || 0;
            player.userData.velocityY -= 0.8 * deltaTime * 60;
            
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
            const moveSpeed = boostActive ? 3.75 : 1.5;
            player.position.x += joystickDirection.x * moveSpeed * deltaTime * 60;
            player.position.z += -joystickDirection.y * moveSpeed * deltaTime * 60;
            player.position.y += player.userData.velocityY * deltaTime;
            
            // Ù…Ù†Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ù†Ø²ÙˆÙ„ ØªØ­Øª Ø§Ù„Ø£Ø±Ø¶
            if (player.position.y < 4) {
                player.position.y = 4;
                player.userData.velocityY = 0;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ³Ø±ÙŠØ¹
            if (boostActive) {
                boostTime -= deltaTime;
                if (boostTime <= 0) {
                    boostActive = false;
                    speedEffect.style.opacity = '0';
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø©
            const horizontalSpeed = Math.sqrt(
                Math.pow(joystickDirection.x * (boostActive ? 3.75 : 1.5), 2) +
                Math.pow(joystickDirection.y * (boostActive ? 3.75 : 1.5), 2)
            );
            speed = horizontalSpeed * 20; // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ÙƒÙ…/Ø³
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§ÙØ©
            distance += horizontalSpeed * deltaTime * 60;
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            speedValue.textContent = Math.round(speed);
            distanceValue.textContent = Math.round(distance);
            
            // ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø·Ø©
            updatePoliceCars(deltaTime);
            
            // Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªØµØ§Ø¯Ù…
            checkCollisions();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø·Ø©
        function updatePoliceCars(deltaTime) {
            policeCars.forEach((policeCar, index) => {
                // ØªØªØ¨Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
                const directionX = player.position.x - policeCar.mesh.position.x;
                const directionZ = player.position.z - policeCar.mesh.position.z;
                const distanceToPlayer = Math.sqrt(directionX * directionX + directionZ * directionZ);
                
                // ØªØ­Ø±ÙŠÙƒ Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø´Ø±Ø·Ø© Ù†Ø­Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨
                if (distanceToPlayer > 8) {
                    const normalizedX = directionX / distanceToPlayer;
                    const normalizedZ = directionZ / distanceToPlayer;
                    
                    policeCar.mesh.position.x += normalizedX * policeCar.speed * deltaTime * 60;
                    policeCar.mesh.position.z += normalizedZ * policeCar.speed * deltaTime * 60;
                    
                    // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù†Ø­Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    policeCar.mesh.lookAt(
                        player.position.x,
                        policeCar.mesh.position.y,
                        player.position.z
                    );
                }
                
                // ØªØ£Ø«ÙŠØ± Ø£Ø¶ÙˆØ§Ø¡ Ø§Ù„Ø¥Ù†Ø°Ø§Ø±
                const time = Date.now() * 0.001;
                policeCar.redLight.material.emissiveIntensity = Math.sin(time * 10) * 0.5 + 0.5;
                policeCar.blueLight.material.emissiveIntensity = Math.cos(time * 10) * 0.5 + 0.5;
                
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø¨Ø´ÙƒÙ„ Ù…ØªÙ‚Ø·Ø¹
                if (Math.random() < 0.01 && distanceToPlayer < 200) {
                    gameAudio.playPoliceSiren();
                }
            });
        }
        
        // Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªØµØ§Ø¯Ù…
        function checkCollisions() {
            // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ
            buildings.forEach(building => {
                const buildingBox = new THREE.Box3().setFromObject(building);
                const playerBox = new THREE.Box3().setFromObject(player);
                
                if (buildingBox.intersectsBox(playerBox)) {
                    // Ø§Ø±ØªØ¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…
                    const overlapX = Math.min(
                        playerBox.max.x - buildingBox.min.x,
                        buildingBox.max.x - playerBox.min.x
                    );
                    const overlapZ = Math.min(
                        playerBox.max.z - buildingBox.min.z,
                        buildingBox.max.z - playerBox.min.z
                    );
                    
                    if (overlapX < overlapZ) {
                        player.position.x -= joystickDirection.x * 0.5;
                    } else {
                        player.position.z -= -joystickDirection.y * 0.5;
                    }
                }
            });
            
            // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø·Ø©
            policeCars.forEach(policeCar => {
                const policeBox = new THREE.Box3().setFromObject(policeCar.mesh);
                const playerBox = new THREE.Box3().setFromObject(player);
                
                if (policeBox.intersectsBox(playerBox)) {
                    endGame();
                }
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
            if (Math.abs(player.position.x) > 1400 || Math.abs(player.position.z) > 1400) {
                endGame();
            }
        }
        
        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function endGame() {
            if (gameEnded) return;
            
            gameEnded = true;
            gameAudio.playCrashSound();
            
            const finalScoreValue = Math.round(distance * 10);
            const finalTimeValue = Math.round((Date.now() - startTime) / 1000);
            
            finalScore.textContent = finalScoreValue;
            finalDistance.textContent = Math.round(distance);
            finalTime.textContent = finalTimeValue;
            
            setTimeout(() => {
                endScreen.style.display = 'flex';
            }, 1000);
        }
        
        // Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function animate() {
            requestAnimationFrame(animate);
            
            const deltaTime = clock.getDelta();
            
            if (gameStarted && !gameEnded) {
                updatePhysics(deltaTime);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                if (typeof updateCamera === 'function') {
                    updateCamera();
                }
                
                // ØªØ¯ÙˆÙŠØ± Ø¹Ù…Ø§Ø±Ø© Ø¨Ø±Ù…Ø¬Ù†ÙŠ
                if (specialBuilding) {
                    specialBuilding.topLayer.rotation.y += 0.005;
                    specialBuilding.middleLayer.rotation.y += 0.005;
                    specialBuilding.bottomLayer.rotation.y += 0.005;
                    specialBuilding.text.rotation.y += 0.005;
                }
            }
            
            renderer.render(scene, camera);
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        simulateLoading();
        
        window.addEventListener('load', () => {
            init();
        });
    </script>
</body>
</html>