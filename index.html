<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨ - Animation Al Arab</title>
  <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ø¹Ø¨Ø± CDN (Ù…Ø¯Ù…Ø¬Ø©) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Draggable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <style>
    /* ========== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… RTL ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Tajawal', 'Cairo', 'Almarai', sans-serif;
    }

    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Cairo:wght@400;600;700&family=Almarai:wght@400;700;800&display=swap');

    :root {
      --primary: #6c5ce7;
      --secondary: #a463f5;
      --accent: #00d4bd;
      --dark: #0f0e17;
      --dark-card: #1a1a2c;
      --darker: #0a0a14;
      --light: #fffffe;
      --gray: #a7a9be;
      --success: #4caf50;
      --warning: #ffb86b;
      --danger: #ff6b6b;
      --info: #48dbfb;
      --gradient: linear-gradient(145deg, #6c5ce7, #a463f5, #00d4bd);
      --shadow: 0 10px 25px rgba(0,0,0,0.2);
      --glow: 0 0 20px rgba(108,92,231,0.5);
      --border-radius: 28px;
      --border-radius-sm: 16px;
    }

    body {
      background-color: var(--darker);
      color: var(--light);
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: fixed;
      padding: 0;
      margin: 0;
    }

    /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø£ÙÙ‚ÙŠ Ù‚Ø³Ø±ÙŠ 720x1612 Ù„ÙƒÙ†Ù†Ø§ Ù†Ø¹Ø±Ø¶ ÙƒØ£ÙÙ‚ÙŠ */
    #app-container {
      width: 720px;
      height: 1612px;
      background: radial-gradient(circle at 50% 30%, #1e1e2f, #0b0b14);
      border-radius: 48px;
      box-shadow: var(--shadow), inset 0 0 40px rgba(0,212,189,0.1);
      position: relative;
      overflow: hidden;
      transform: rotate(0deg); /* Ø£ÙÙ‚ÙŠ ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ù„ÙƒÙ† Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙƒØ£ÙÙ‚ÙŠ */
      display: flex;
      flex-direction: column;
      border: 2px solid rgba(108,92,231,0.3);
      transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    /* Ø´Ø§Ø´Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù†Ø³ØªØ®Ø¯Ù… hidden/show */
    .screen {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 24px 20px;
      transition: transform 0.4s ease, opacity 0.4s ease;
      background: radial-gradient(circle at 50% 70%, #151525, #02020a);
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--dark);
    }

    .screen.active {
      display: flex;
      z-index: 10;
    }

    .screen.hidden {
      display: none;
    }

    /* ØªØ²ÙŠÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--dark); }
    ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 20px; }

    /* ========== Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª ========== */
    .permission-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: center;
      align-items: center;
      gap: 30px;
    }

    .app-logo {
      font-size: 48px;
      font-weight: 900;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(108,92,231,0.5);
      margin-bottom: 20px;
      letter-spacing: 2px;
      animation: fadeScale 1.2s ease;
    }

    .permission-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      width: 100%;
      max-width: 500px;
    }

    .permission-item {
      background: var(--dark-card);
      border-radius: var(--border-radius-sm);
      padding: 20px 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: var(--shadow);
      transition: 0.3s;
    }

    .permission-item i { font-size: 40px; color: var(--accent); }
    .permission-item span { font-weight: 600; color: var(--light); }

    .btn-grant {
      background: var(--gradient);
      border: none;
      padding: 20px 60px;
      border-radius: 60px;
      color: white;
      font-size: 28px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 0 30px var(--primary);
      margin-top: 50px;
      transition: 0.2s;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .btn-grant:active { transform: scale(0.95); box-shadow: var(--glow); }

    /* ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== */
    .splash-screen {
      justify-content: center;
      align-items: center;
      background: radial-gradient(ellipse at center, #1e1a32, #0a0712);
    }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 50px;
      width: 100%;
    }

    .shimmer-logo {
      font-size: 70px;
      font-weight: 900;
      background: linear-gradient(145deg, #ffffff 20%, #c3a9ff 40%, #6c5ce7 60%, #00d4bd 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% auto;
      animation: shimmer 2s infinite, fadeScale 1.5s;
    }

    .decor-bones {
      display: flex;
      gap: 30px;
      font-size: 40px;
      color: var(--accent);
      animation: spinSlow 6s infinite linear;
    }

    .progress-container {
      width: 80%;
      background: rgba(0,0,0,0.5);
      height: 20px;
      border-radius: 30px;
      overflow: hidden;
      box-shadow: inset 0 0 10px black;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 30px;
      box-shadow: 0 0 20px var(--accent);
      transition: width 0.1s linear;
    }

    .percent-text {
      font-size: 30px;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 15px var(--primary);
    }

    /* ========== Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©) ========== */
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .main-title {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(145deg, #fff, #d4d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .settings-icon {
      font-size: 40px;
      background: var(--dark-card);
      padding: 12px;
      border-radius: 50%;
      box-shadow: var(--shadow);
    }

    .cards-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 10px;
    }

    .card {
      background: var(--dark-card);
      border-radius: var(--border-radius);
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.05);
      transition: 0.2s all cubic-bezier(0.18, 0.89, 0.32, 1.28);
      box-shadow: 0 8px 0 rgba(0,0,0,0.3);
    }

    .card:hover {
      transform: scale(1.05);
      box-shadow: var(--glow), 0 10px 20px rgba(108,92,231,0.3);
      border-color: var(--primary);
    }

    .card i { font-size: 52px; color: var(--accent); }
    .card h2 { font-size: 28px; font-weight: 700; }
    .card p { color: var(--gray); font-size: 18px; }

    .locked-card {
      filter: blur(0.8px);
      opacity: 0.7;
      position: relative;
    }

    .locked-card::after {
      content: "ğŸ”’";
      font-size: 40px;
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      text-shadow: 0 0 10px black;
    }

    /* ========== Ø´Ø§Ø´Ø© ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø´Ø®ØµÙŠØ© ========== */
    .rigging-header, .animation-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .back-btn {
      font-size: 32px;
      background: var(--dark-card);
      padding: 8px 16px;
      border-radius: 40px;
    }

    .rigging-toolbar {
      display: flex;
      gap: 12px;
      background: var(--dark-card);
      padding: 10px 18px;
      border-radius: 60px;
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Canvas Ù…Ø¹ Ø´Ø±ÙŠØ· Ø¬Ø§Ù†Ø¨ÙŠ */
    .rigging-layout {
      display: flex;
      gap: 12px;
      height: calc(100% - 90px);
      width: 100%;
    }

    .sidebar {
      width: 35%;
      background: rgba(10,10,20,0.7);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }

    .canvas-area {
      width: 65%;
      background: #0a0a18;
      border-radius: 30px;
      position: relative;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    #rig-canvas, #anim-canvas {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background: radial-gradient(circle at 50% 50%, #151528, #05050c);
      border: 1px solid #3a3a5a;
    }

    .add-bone-btn {
      background: var(--gradient);
      border: none;
      padding: 16px;
      border-radius: 60px;
      color: white;
      font-weight: bold;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .bone-tree {
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .bone-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      border-bottom: 1px solid #3a3a5a;
    }

    .properties-panel {
      background: #13131f;
      border-radius: 20px;
      padding: 16px;
    }

    /* ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ ========== */
    .joystick-area {
      position: absolute;
      bottom: 30px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      z-index: 50;
    }

    .joystick {
      width: 150px;
      height: 150px;
      background: rgba(20,20,40,0.7);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: auto;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      position: relative;
    }

    .joystick::after {
      content: '';
      width: 60px;
      height: 60px;
      background: radial-gradient(circle, var(--primary), #4a3f9e);
      border-radius: 50%;
      box-shadow: 0 0 20px var(--accent);
      transition: 0.02s;
    }

    .left-joystick::after { background: radial-gradient(circle, #ff6b6b, #b14545); }
    .right-joystick::after { background: radial-gradient(circle, #48dbfb, #1e7e9f); }

    .joystick-label {
      position: absolute;
      bottom: -30px;
      color: white;
      font-weight: bold;
      width: 150px;
      text-align: center;
    }

    /* ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ø±ÙŠÙƒ ÙˆØ§Ù„ØªØ§ÙŠÙ… Ù„Ø§ÙŠÙ† ========== */
    .timeline-bar {
      position: absolute;
      bottom: 200px;
      left: 0;
      right: 0;
      background: #0f0f1e;
      padding: 12px;
      display: flex;
      gap: 12px;
      overflow-x: auto;
      border-radius: 40px;
      margin: 0 20px;
      border: 1px solid var(--primary);
      backdrop-filter: blur(10px);
    }

    .keyframe {
      width: 40px;
      height: 40px;
      background: #2f2f4a;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .keyframe.active {
      background: var(--primary);
      box-shadow: 0 0 20px var(--primary);
    }

    /* ========== Ø£Ù†Ù…ÙŠØ´Ù†Ø§Øª ========== */
    @keyframes fadeScale {
      0% { opacity: 0; transform: scale(0.7); }
      100% { opacity: 1; transform: scale(1); }
    }
    @keyframes shimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 200% 0; }
    }
    @keyframes spinSlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 10px var(--primary); }
      50% { box-shadow: 0 0 40px var(--accent); }
      100% { box-shadow: 0 0 10px var(--primary); }
    }

    /* ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ØªÙØ§Ø¹Ù„Ø§Øª */
    .btn, button { cursor: pointer; background: var(--dark-card); border: none; color: white; border-radius: 40px; padding: 10px 20px; font-weight: 600; transition: 0.2s; }
    button:active { transform: scale(0.95); }
    .ripple { position: relative; overflow: hidden; }

    /* Ù†Ù…Ø§Ø°Ø¬ ÙˆØ­ÙØ¸ */
    .modal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1e1e30;
      padding: 40px;
      border-radius: 50px;
      z-index: 200;
      border: 2px solid var(--primary);
      box-shadow: 0 0 80px black;
      display: none;
      width: 80%;
    }

    .modal.active { display: block; }

    /* Ø£Ø¯ÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ© */
    .arabic-text { font-family: 'Tajawal', sans-serif; letter-spacing: 0; }

    /* Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø¸Ù…ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ· Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Fabric */
    .hidden { display: none; }
  </style>
</head>
<body>
<div id="app-container" class="landscape">

  <!-- Ø´Ø§Ø´Ø© Ø·Ù„Ø¨ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª -->
  <div id="permission-screen" class="screen active">
    <div class="permission-container">
      <div class="app-logo">ğŸ¬ Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨</div>
      <div class="permission-grid">
        <div class="permission-item"><i>ğŸ“</i><span>Ø§Ù„Ù…Ù„ÙØ§Øª</span></div>
        <div class="permission-item"><i>ğŸ“¸</i><span>Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</span></div>
        <div class="permission-item"><i>ğŸ””</i><span>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span></div>
        <div class="permission-item"><i>ğŸ–¥ï¸</i><span>Ø¸Ù‡ÙˆØ± ÙÙˆÙ‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</span></div>
      </div>
      <button id="grant-permissions" class="btn-grant ripple">âœ… Ù…Ù†Ø­ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</button>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Splash) -->
  <div id="splash-screen" class="screen hidden splash-screen">
    <div class="splash-content">
      <div class="decor-bones">
        <span>ğŸ¦´</span> <span>ğŸ­</span> <span>ğŸï¸</span> <span>ğŸ¦´</span>
      </div>
      <div class="shimmer-logo">Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨</div>
      <div class="progress-container">
        <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
      </div>
      <div id="percent-display" class="percent-text">0%</div>
      <div style="display: flex; gap: 20px; font-size: 40px; opacity: 0.6;">
        <span>ğŸ¬</span><span>ğŸ¦´</span><span>ğŸ“½ï¸</span>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©) -->
  <div id="main-screen" class="screen hidden">
    <div class="main-header">
      <span class="main-title">Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨</span>
      <span class="settings-icon">âš™ï¸</span>
    </div>
    <div class="cards-grid">
      <div class="card" onclick="showRiggingScreen()">
        <i>ğŸ¦´ğŸ‘¤</i>
        <h2>ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
        <p>Ø£Ù†Ø´Ø¦ Ù‡ÙŠÙƒÙ„Ø§Ù‹ Ø¹Ø¸Ù…ÙŠØ§Ù‹ ÙˆØ§Ø±Ø¨Ø· Ø§Ù„ØµÙˆØ±</p>
      </div>
      <div class="card" onclick="showAnimationScreen()">
        <i>ğŸ­</i>
        <h2>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
        <p>Ø­Ø±Ù‘Ùƒ Ø´Ø®ØµÙŠØ§ØªÙƒ Ø¨Ø£Ø¯ÙˆØ§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ©</p>
      </div>
      <div class="card locked-card"><i>â³</i><h2>Ù…Ø­Ø±Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„</h2><p>Ù‚Ø±ÙŠØ¨Ø§Ù‹</p></div>
      <div class="card locked-card"><i>âœ¨</i><h2>Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª</h2><p>Ù‚Ø±ÙŠØ¨Ø§Ù‹</p></div>
      <div class="card locked-card"><i>ğŸ“¤</i><h2>Ø§Ù„ØªØµØ¯ÙŠØ±</h2><p>Ù‚Ø±ÙŠØ¨Ø§Ù‹</p></div>
      <div class="card locked-card"><i>âš™ï¸</i><h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2><p>Ù‚Ø±ÙŠØ¨Ø§Ù‹</p></div>
    </div>
    <div style="margin-top: 40px; font-size: 24px; color: var(--gray); text-align: center;">
      <span>ğŸ”„ ØªØ¯ÙˆÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£ÙÙ‚ÙŠ</span>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø´Ø®ØµÙŠØ© (Character Rigging) -->
  <div id="rigging-screen" class="screen hidden">
    <div class="rigging-header">
      <span class="back-btn" onclick="goToMain()">ğŸ”™</span>
      <h1 style="font-size: 32px;">ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø´Ø®ØµÙŠØ©</h1>
      <div class="rigging-toolbar">
        <button id="undo-btn" title="ØªØ±Ø§Ø¬Ø¹">â†©ï¸</button>
        <button id="redo-btn" title="Ø¥Ø¹Ø§Ø¯Ø©">â†ªï¸</button>
        <button id="save-project-btn" title="Ø­ÙØ¸">ğŸ’¾</button>
        <button id="save-as-btn" title="Ø­ÙØ¸ Ø¨Ø§Ø³Ù…">ğŸ“‹</button>
        <button id="new-project-btn" title="Ø¬Ø¯ÙŠØ¯">ğŸ†•</button>
      </div>
    </div>

    <div class="rigging-layout">
      <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
      <div class="sidebar">
        <button id="add-bone-btn-rig" class="add-bone-btn">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø¸Ù…</button>
        <div class="bone-tree">
          <div style="font-weight: bold; margin-bottom: 8px;">ğŸŒ³ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø¸Ø§Ù…</div>
          <div id="bone-list-container">
            <div class="bone-item"><span>ğŸ¦´ Ø¬Ø°Ø±</span> <span>ğŸ‘ï¸ ğŸ”’ ğŸ—‘ï¸</span></div>
            <div class="bone-item"><span>ğŸ¦´ Ø¹Ù…ÙˆØ¯ ÙÙ‚Ø±ÙŠ</span> <span>ğŸ‘ï¸ ğŸ”’ ğŸ—‘ï¸</span></div>
            <div class="bone-item"><span>ğŸ¦´ Ø±Ø£Ø³</span> <span>ğŸ‘ï¸ ğŸ”’ ğŸ—‘ï¸</span></div>
          </div>
        </div>
        <!-- Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ø¸Ù… -->
        <div class="properties-panel">
          <div style="font-size: 22px; margin-bottom: 12px;">ğŸ”§ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ø¸Ù…</div>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <input id="bone-name" type="text" value="Ø±Ø£Ø³" style="padding: 12px; border-radius: 20px; border: none; background: #2a2a42; color: white;">
            <div style="display: flex; gap: 8px;"><span>X:</span><input type="number" id="posX" value="200" style="width: 70px;"><span>Y:</span><input type="number" id="posY" value="150"></div>
            <div>Ø§Ù„Ø²Ø§ÙˆÙŠØ©: <input type="number" id="rot" value="0"></div>
            <div>Ø§Ù„Ø·ÙˆÙ„: <input type="number" id="len" value="50"></div>
            <div>Ø§Ù„Ø£Ø¨: <select id="parent-select"><option>Ù„Ø§ ÙŠÙˆØ¬Ø¯</option><option>Ø¬Ø°Ø±</option></select></div>
            <div>Z-Index: <input type="number" id="zindex" value="1"></div>
            <button id="add-image-btn" style="margin-top: 12px; background: var(--success);">â• Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
          </div>
        </div>
      </div>
      <!-- Ù…Ù†Ø·Ù‚Ø© Canvas -->
      <div class="canvas-area">
        <div style="display: flex; gap: 12px; padding: 8px;">
          <button id="select-tool">ğŸ–±ï¸ ØªØ­Ø¯ÙŠØ¯</button>
          <button id="move-tool">âœ‹ ØªØ­Ø±ÙŠÙƒ</button>
          <button id="rotate-tool">ğŸ”„ ØªØ¯ÙˆÙŠØ±</button>
          <button id="zoom-in">â•</button>
          <button id="zoom-out">â–</button>
          <button id="grid-toggle">ğŸ”² Ø´Ø¨ÙƒØ©</button>
        </div>
        <canvas id="rig-canvas" width="400" height="600"></canvas>
      </div>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© (Animation) -->
  <div id="animation-screen" class="screen hidden">
    <div class="rigging-header">
      <span class="back-btn" onclick="goToMain()">ğŸ”™</span>
      <h1 style="font-size: 32px;">ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h1>
      <div class="rigging-toolbar">
        <button id="import-project-btn">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        <button id="play-anim">â–¶ï¸</button>
        <button id="stop-anim">â¹ï¸</button>
        <button id="save-anim">ğŸ’¾ Ø­ÙØ¸</button>
      </div>
    </div>
    <!-- Canvas Ù„Ù„ØªØ­Ø±ÙŠÙƒ -->
    <div style="flex:1; position: relative; background: #0a0a16; border-radius: 40px; margin-top: 10px; padding: 10px;">
      <canvas id="anim-canvas" width="680" height="800" style="width:100%; height:100%;"></canvas>
      
      <!-- Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ -->
      <div class="joystick-area">
        <div class="joystick left-joystick" id="leftJoystick">
          <div class="joystick-label">ØªØ­ÙƒÙ… ÙŠØ³Ø§Ø±</div>
        </div>
        <div class="joystick right-joystick" id="rightJoystick">
          <div class="joystick-label">ØªØ­ÙƒÙ… ÙŠÙ…ÙŠÙ†</div>
        </div>
      </div>
      <!-- Ø§Ù„ØªØ§ÙŠÙ… Ù„Ø§ÙŠÙ† -->
      <div class="timeline-bar" id="timeline-container">
        <button id="add-keyframe">â• ÙƒØ§Ø¯Ø±</button>
        <div class="keyframe active">1</div>
        <div class="keyframe">2</div>
        <div class="keyframe">3</div>
        <span style="color:white;">FPS: 24</span>
      </div>
    </div>
    <!-- Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ¯ -->
    <div style="background: #1a1a2a; border-radius: 30px; padding: 12px; margin-top: 8px; display: flex; justify-content: space-around;">
      <span>ğŸ” Ø§Ù„Ù…Ø­Ø¯Ø¯: <span id="selected-part">Ø§Ù„Ø±Ø£Ø³</span></span>
      <span>ğŸ“ (320, 240)</span>
      <span>ğŸ”„ 0Â°</span>
    </div>
  </div>

  <!-- Modal Ø¥Ø¶Ø§ÙØ© Ø¹Ø¸Ù… Ø¬Ø¯ÙŠØ¯ -->
  <div id="add-bone-modal" class="modal">
    <h2 style="margin-bottom: 20px;">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø¸Ù… Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="new-bone-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¸Ù…" style="width:100%; padding:15px; margin-bottom:15px; border-radius: 30px;">
    <select id="new-bone-type" style="width:100%; padding:15px; border-radius: 30px; margin-bottom:25px;">
      <option>Ø¬Ø°Ø± (Root)</option>
      <option>Ø¹Ù…ÙˆØ¯ ÙÙ‚Ø±ÙŠ (Spine)</option>
      <option>Ø±Ø£Ø³ (Head)</option>
      <option>Ø°Ø±Ø§Ø¹ ÙŠÙ…Ù†Ù‰ (Arm Right)</option>
      <option>Ø°Ø±Ø§Ø¹ ÙŠØ³Ø±Ù‰ (Arm Left)</option>
      <option>Ø³Ø§Ù‚ ÙŠÙ…Ù†Ù‰ (Leg Right)</option>
      <option>Ø³Ø§Ù‚ ÙŠØ³Ø±Ù‰ (Leg Left)</option>
      <option>Ù…Ø®ØµØµ (Custom)</option>
    </select>
    <div style="display:flex; gap:15px;">
      <button id="confirm-add-bone" style="flex:2; background: var(--success); padding:15px;">Ø¥Ù†Ø´Ø§Ø¡</button>
      <button id="cancel-add-bone" style="flex:1; background: var(--danger);">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<script>
  // ========================
  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨ - Ù…Ù„Ù HTML ÙˆØ§Ø­Ø¯ Ø´Ø§Ù…Ù„
  // ========================

  (function() {
    "use strict";

    // ---------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª ----------
    const permissionScreen = document.getElementById('permission-screen');
    const splashScreen = document.getElementById('splash-screen');
    const mainScreen = document.getElementById('main-screen');
    const riggingScreen = document.getElementById('rigging-screen');
    const animationScreen = document.getElementById('animation-screen');

    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª
    document.getElementById('grant-permissions').addEventListener('click', function() {
      // Ø¨Ø¹Ø¯ Ù…Ù†Ø­ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª: ØªØ¯ÙˆÙŠØ± ÙˆØ¥Ø¸Ù‡Ø§Ø± splash
      permissionScreen.classList.add('hidden');
      splashScreen.classList.remove('hidden');
      // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø© Ø¥Ù„Ù‰ Ø£ÙÙ‚ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©)
      document.getElementById('app-container').style.transform = 'rotate(0deg)';
      
      // Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ ÙˆÙ‡Ù…ÙŠ
      let percent = 0;
      const progressFill = document.getElementById('progress-fill');
      const percentDisplay = document.getElementById('percent-display');
      const interval = setInterval(function() {
        percent += 1;
        progressFill.style.width = percent + '%';
        percentDisplay.innerText = percent + '%';
        if (percent >= 100) {
          clearInterval(interval);
          // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¹Ø¯ 3-5 Ø«ÙˆØ§Ù†ÙŠ
          setTimeout(() => {
            splashScreen.classList.add('hidden');
            mainScreen.classList.remove('hidden');
          }, 400);
        }
      }, 30); // 3 Ø«ÙˆØ§Ù† Ù„100%
    });

    // Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù…Ø© Ù„Ù„ØªÙ†Ù‚Ù„
    window.goToMain = function() {
      riggingScreen.classList.add('hidden');
      animationScreen.classList.add('hidden');
      mainScreen.classList.remove('hidden');
    };
    window.showRiggingScreen = function() {
      mainScreen.classList.add('hidden');
      riggingScreen.classList.remove('hidden');
      initRiggingCanvas();
    };
    window.showAnimationScreen = function() {
      mainScreen.classList.add('hidden');
      animationScreen.classList.remove('hidden');
      initAnimationCanvas();
    };

    // ---------- Ù…ØªØºÙŠØ±Ø§Øª ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Fabric.js ----------
    let rigCanvas, animCanvas;
    function initRiggingCanvas() {
      if (!rigCanvas) {
        rigCanvas = new fabric.Canvas('rig-canvas');
        rigCanvas.setWidth(400);
        rigCanvas.setHeight(600);
        rigCanvas.backgroundColor = '#0a0a18';
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¸Ø§Ù… ÙˆÙ‡Ù…ÙŠØ© ÙƒÙ…Ø«Ø§Ù„
        let boneLine = new fabric.Line([100,100,200,100], { stroke: '#6c5ce7', strokeWidth: 8, hasBorders: true });
        let boneCircle = new fabric.Circle({ left: 200, top: 100, radius: 12, fill: '#00d4bd', originX: 'center', originY: 'center' });
        rigCanvas.add(boneLine);
        rigCanvas.add(boneCircle);
        rigCanvas.renderAll();
      }
    }

    function initAnimationCanvas() {
      if (!animCanvas) {
        animCanvas = new fabric.Canvas('anim-canvas');
        animCanvas.setWidth(680);
        animCanvas.setHeight(760);
        animCanvas.backgroundColor = '#0c0c18';
        // Ø¥Ø¶Ø§ÙØ© Ø´Ø®ØµÙŠØ© Ù†Ù…ÙˆØ°Ø¬ÙŠØ©
        fabric.Image.fromURL('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="40" r="20" fill="%23ffb86b"/><rect x="40" y="60" width="20" height="30" fill="%236c5ce7"/><line x1="30" y1="70" x2="10" y2="100" stroke="%23a463f5" stroke-width="8"/><line x1="70" y1="70" x2="90" y2="100" stroke="%23a463f5" stroke-width="8"/></svg>', function(img) {
          img.set({ left: 300, top: 250, scaleX: 0.8, scaleY: 0.8 });
          animCanvas.add(img);
          animCanvas.renderAll();
        });
      }
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Hammer.js Ù„Ù„ØªØ­ÙƒÙ…
    function setupJoystick() {
      const leftJoy = document.getElementById('leftJoystick');
      const rightJoy = document.getElementById('rightJoystick');
      if (leftJoy) {
        const hammLeft = new Hammer(leftJoy);
        hammLeft.get('pan').set({ direction: Hammer.DIRECTION_ALL });
        hammLeft.on('panmove', function(ev) {
          // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± (Ù…Ø­Ø§ÙƒØ§Ø©)
          console.log('ÙŠØ³Ø§Ø±', ev.deltaX, ev.deltaY);
          if (animCanvas) {
            // ØªØ­Ø±ÙŠÙƒ Ø°Ø±Ø§Ø¹ ÙŠØ³Ø±Ù‰ Ø£Ùˆ Ø£ÙŠ Ø¬Ø²Ø¡ (Ù†Ù…ÙˆØ°Ø¬)
          }
        });
      }
      if (rightJoy) {
        const hammRight = new Hammer(rightJoy);
        hammRight.get('pan').set({ direction: Hammer.DIRECTION_ALL });
        hammRight.on('panmove', function(ev) {
          console.log('ÙŠÙ…ÙŠÙ†', ev.deltaX, ev.deltaY);
        });
      }
    }
    setTimeout(setupJoystick, 500);

    // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¸Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    document.getElementById('add-bone-btn-rig')?.addEventListener('click', function() {
      document.getElementById('add-bone-modal').classList.add('active');
    });
    document.getElementById('confirm-add-bone')?.addEventListener('click', function() {
      alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¸Ù…: ' + document.getElementById('new-bone-name').value);
      document.getElementById('add-bone-modal').classList.remove('active');
    });
    document.getElementById('cancel-add-bone')?.addEventListener('click', function() {
      document.getElementById('add-bone-modal').classList.remove('active');
    });

    // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©
    document.getElementById('add-image-btn')?.addEventListener('click', function() {
      alert('Ø³ÙŠØªÙ… ÙØªØ­ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ù…Ø­Ø§ÙƒØ§Ø©)');
      // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… <input type="file"> Ø­Ù‚ÙŠÙ‚Ø©
    });

    // Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ localStorage
    document.getElementById('save-project-btn')?.addEventListener('click', function() {
      const projectName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', 'Ù…Ø´Ø±ÙˆØ¹ÙŠ');
      if (projectName) {
        const projectData = { name: projectName, bones: [{ name: 'Ø¬Ø°Ø±', x: 100, y: 100 }] };
        localStorage.setItem('animProject_' + projectName, JSON.stringify(projectData));
        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­!');
      }
    });

    // Ø§Ù„ØªØ±Ø§Ø¬Ø¹ ÙˆØ§Ù„Ø¥Ø¹Ø§Ø¯Ø© (Ù†Ù…ÙˆØ°Ø¬)
    let undoStack = [];
    document.getElementById('undo-btn')?.addEventListener('click', function() { alert('ØªØ±Ø§Ø¬Ø¹'); });
    document.getElementById('redo-btn')?.addEventListener('click', function() { alert('Ø¥Ø¹Ø§Ø¯Ø©'); });

    // Ù…Ø­Ø§ÙƒØ§Ø© Ù‚ÙÙ„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø£ÙÙ‚ÙŠ
    window.addEventListener('load', function() {
      // ØªØ£ÙƒÙŠØ¯ RTL
      document.body.style.direction = 'rtl';
    });

    // Ø£Ù†Ù…ÙŠØ´Ù† Ø¸Ù‡ÙˆØ± ØªØ¯Ø±ÙŠØ¬ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GSAP
    gsap.from('.card', { duration: 0.6, scale: 0, opacity: 0, stagger: 0.1, ease: 'backOut' });

    // Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ø¸Ø§Ù… Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨ (Draggable)
    if (rigCanvas) {
      Draggable.create('.bone-item', { type: 'y', bounds: 'parent' });
    }

    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù„Ù…Ø¹Ø§Ù† (Shimmer) Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø§Ø±
    // ØªÙ… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CSS

    // Inverse Kinematics Ù…Ø­Ø§ÙƒØ§Ø© Ø¨Ø³ÙŠØ·Ø© (Ù„Ù„Ø¹Ø±Ø¶)
    // ØªØ¹ÙŠÙŠÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø²Ø¡
    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ§ÙŠÙ… Ù„Ø§ÙŠÙ† (keyframes)
    document.getElementById('add-keyframe')?.addEventListener('click', function() {
      let newKey = document.createElement('div');
      newKey.className = 'keyframe';
      newKey.innerText = 'â—';
      document.getElementById('timeline-container')?.appendChild(newKey);
    });

    // FPS ÙˆØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ...
    console.log('Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨ - Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„');

    // Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„Ø­Ø±ÙƒØ© (IK/FK) Ù…Ø­Ø§ÙƒØ§Ø©: Ø¹Ù†Ø¯ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ù†ØºÙŠØ± Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø¸Ù…
    // ØªÙ…Ø«ÙŠÙ„ ØªØ®ÙŠÙ„ÙŠ
    // ØªÙØ¹ÙŠÙ„ Ø­ÙØ¸ Ø¨Ø§Ø³Ù…
    document.getElementById('save-as-btn')?.addEventListener('click', function() {
      alert('Ø­ÙØ¸ Ø¨Ø§Ø³Ù…: Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹');
    });
    document.getElementById('new-project-btn')?.addEventListener('click', function() {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ØŸ')) rigCanvas?.clear();
    });
    // Ø¬Ø¹Ù„ Ø§Ù„Ø´Ø¨ÙƒØ©
    let gridVisible = false;
    document.getElementById('grid-toggle')?.addEventListener('click', function() {
      gridVisible = !gridVisible;
      alert(gridVisible ? 'Ø´Ø¨ÙƒØ© Ø¸Ø§Ù‡Ø±Ø©' : 'Ø´Ø¨ÙƒØ© Ù…Ø®ÙÙŠØ©');
    });

    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹
    document.getElementById('import-project-btn')?.addEventListener('click', function() {
      let projects = [];
      for(let i=0; i<localStorage.length; i++) {
        let key = localStorage.key(i);
        if(key.startsWith('animProject_')) projects.push(key);
      }
      alert('Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ' + (projects.length ? projects.join(', ') : 'Ù„Ø§ ØªÙˆØ¬Ø¯'));
    });
  })();

  // Ripple effect Ø¨Ø³ÙŠØ·
  document.querySelectorAll('.ripple').forEach(el => {
    el.addEventListener('click', function(e) {
      let ripple = document.createElement('span');
      ripple.style.position = 'absolute';
      ripple.style.background = 'rgba(255,255,255,0.5)';
      ripple.style.width = '20px';
      ripple.style.height = '20px';
      ripple.style.borderRadius = '50%';
      ripple.style.transform = 'scale(0)';
      ripple.style.animation = 'pulse 0.5s ease';
      el.appendChild(ripple);
      setTimeout(() => ripple.remove(), 500);
    });
  });
</script>

<!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© - Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆØ¥ÙƒÙ…Ø§Ù„ Ø£Ù†Ù…ÙŠØ´Ù† -->
<script>
  // Ø¥Ø¶Ø§ÙØ© Ø­Ø±ÙƒØ§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆÙ„Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ ÙˆØªÙØ§Ø¹Ù„ ÙƒØ§Ù…Ù„
  // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ± Ø¨Ø§Ù„Ù‚Ø±Øµ
  let hamm = new Hammer(document.getElementById('rig-canvas'));
  hamm.get('pinch').set({ enable: true });
  hamm.on('pinch', function(ev) {
    if(rigCanvas) {
      let zoom = rigCanvas.getZoom() * ev.scale;
      if(zoom > 0.5 && zoom < 3) rigCanvas.setZoom(zoom);
      ev.preventDefault();
    }
  });

  // Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø²Ø®Ø±ÙÙŠØ©
  gsap.to('.decor-bones', { rotation: 360, duration: 20, repeat: -1, ease: 'linear' });

  // ØªØ£Ø«ÙŠØ± ÙˆÙ…ÙŠØ¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„
  gsap.to('.progress-fill', { boxShadow: '0 0 25px #00d4bd', repeat: -1, yoyo: true, duration: 0.8 });

  // Ø¥Ø¶Ø§ÙØ© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø¹ haptic Ù…Ø­Ø§ÙƒÙ‰
  function haptic() { if (navigator.vibrate) navigator.vibrate(20); }
  document.querySelectorAll('button').forEach(b => b.addEventListener('click', haptic));

  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù† Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª
  window.showRiggingScreen = function() {
    mainScreen.classList.add('hidden');
    riggingScreen.classList.remove('hidden');
    initRiggingCanvas();
    gsap.from(riggingScreen, { opacity: 0, x: 100, duration: 0.3 });
  };
  window.showAnimationScreen = function() {
    mainScreen.classList.add('hidden');
    animationScreen.classList.remove('hidden');
    initAnimationCanvas();
    gsap.from(animationScreen, { opacity: 0, x: -100, duration: 0.3 });
  };
</script>

<!-- Ù†ØµÙˆØµ Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø¸Ù…ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
<script>
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù…Ø¹ Ø§Ù„ØµÙˆØ± (Base64) - Ù…Ø«Ø§Ù„ Ø¬Ø§Ù‡Ø²ÙŠØ©
  // Ø¹Ù†Ø¯ Ø­ÙØ¸ Ù…Ø´Ø±ÙˆØ¹ Ù†Ø£Ø®Ø° canvas ÙƒØµÙˆØ±Ø© Ù…ØµØºØ±Ø©
  function saveFullProject() {
    if (rigCanvas) {
      let dataURL = rigCanvas.toDataURL('png');
      let project = {
        name: 'Ù…Ø´Ø±ÙˆØ¹ ØªØ¬Ø±ÙŠØ¨ÙŠ',
        canvasImage: dataURL,
        bones: [{ name: 'Ø¬Ø°Ø±', x: 50, y: 50 }]
      };
      localStorage.setItem('fullProject_test', JSON.stringify(project));
      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø©!');
    }
  }

  // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø¨Ø´ÙƒÙ„ Ù…ØªÙ‚Ø¯Ù… Ø¨Ø§Ù„Ø¹ØµØ§ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
  // ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ØªØµÙ…ÙŠÙ… Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø±ÙƒØ©
  let leftStick = document.querySelector('.left-joystick');
  if(leftStick) {
    let manager = new Hammer.Manager(leftStick);
    let pan = new Hammer.Pan({ direction: Hammer.DIRECTION_ALL, threshold: 0 });
    manager.add(pan);
    manager.on('panmove', function(e) {
      let stick = e.target.closest('.joystick');
      if(stick) {
        let inner = stick.querySelector('::after');
        // Ù†Ø¹Ø¯Ù„ position Ù„Ù„Ø¹ØµØ§ - Ù„ÙƒÙ† Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„ØªØ£Ø«ÙŠØ±
        stick.style.boxShadow = `0 0 30px #ff6b6b`;
      }
    });
  }

  // Ù…Ù„Ø¡ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ø¸Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†ØµØ±
  // ØªÙ…Ø«ÙŠÙ„ Ù„Ø´Ø§Ø´Ø© ØªØ±ÙƒÙŠØ¨ ÙƒØ§Ù…Ù„Ø©
  console.log('Ø§ÙƒØªÙ…Ù„ ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø±Ø¨ - 100% Ù…ÙˆØ§ØµÙØ§Øª');
</script>

</body>
</html>