<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PUBG Mobile - No Lag Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap');
        * { box-sizing: border-box; user-select: none; touch-action: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; font-family: 'Cairo', sans-serif; }
        
        canvas { display: block; width: 100%; height: 100%; background: #222; }

        /* HUD - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        #ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* Ù…ÙŠÙ†ÙŠ Ù…Ø§Ø¨ */
        #minimap { position: absolute; top: 10px; right: 10px; width: 110px; height: 110px; background: rgba(0,0,0,0.5); border: 2px solid #fff; border-radius: 8px; overflow: hidden; }
        #player-marker { position: absolute; width: 6px; height: 6px; background: #0f0; border-radius: 50%; transform: translate(-50%, -50%); }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .btn { position: absolute; border-radius: 50%; display: flex; justify-content: center; align-items: center; pointer-events: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        #fire-btn { bottom: 30px; right: 30px; width: 90px; height: 90px; background: rgba(255, 0, 0, 0.6); border: 4px solid #fff; font-size: 40px; }
        #jump-btn { bottom: 130px; right: 40px; width: 55px; height: 55px; background: rgba(255,255,255,0.2); border: 2px solid #fff; color: #fff; font-size: 14px; }
        
        /* Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        #health-wrap { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 200px; height: 12px; background: #333; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        #health-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #f00, #0f0); }

        #weapon-card { position: absolute; bottom: 20px; right: 130px; color: #ffcc00; text-shadow: 1px 1px 2px #000; text-align: right; }
        #game-info { position: absolute; top: 15px; left: 15px; color: #fff; background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 5px; font-size: 14px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; color:orange; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:2000; }
        #start-bt { padding: 15px 50px; background: orange; color: #000; border: none; border-radius: 30px; font-weight: bold; font-size: 20px; cursor: pointer; display: none; }
        
        /* ÙÙ„Ø§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØµØ§Ø¨Ø© */
        #damage-flash { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(255,0,0,0.3); pointer-events: none; display: none; }
    </style>
</head>
<body>

<div id="loading">
    <h1 style="margin-bottom:10px;">PUBG MOBILE</h1>
    <p id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹...</p>
    <button id="start-bt">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</button>
</div>

<canvas id="gameCanvas"></canvas>
<div id="damage-flash"></div>

<div id="ui-overlay">
    <div id="game-info">ğŸ‘¤ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡: <span id="alive">16</span> | ğŸ’€ Ø§Ù„Ù‚ØªÙ„Ù‰: <span id="kills">0</span></div>
    
    <div id="minimap">
        <div id="zone-circle" style="position:absolute; border:1px solid #00f; border-radius:50%; transform:translate(-50%,-50%);"></div>
        <div id="player-marker"></div>
    </div>

    <div id="health-wrap"><div id="health-fill"></div></div>

    <div id="weapon-card">
        <div style="font-size: 20px;">M416</div>
        <div id="ammo">âˆ / 30</div>
    </div>

    <div id="fire-btn" class="btn">ğŸ”«</div>
    <div id="jump-btn" class="btn">UP</div>
</div>

<script>
/**
 * Ù…Ø­Ø±Ùƒ Ù„Ø¹Ø¨Ø© PUBG Mobile - Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙØ§Ø¦Ù‚
 * ØªÙ… Ø¨Ù†Ø§Ø¤Ù‡ Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let width, height;

// Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
const player = {
    x: 0, z: 0, 
    yaw: 0, pitch: 0,
    hp: 100, kills: 0,
    vY: 0, onGround: true,
    moveF: 0, moveS: 0
};

// Ø§Ù„Ø¹Ø§Ù„Ù…
let bots = [];
let walls = [];
let zoneRadius = 500;
const MAP_SIZE = 1000;

// Ø§Ù„ØµÙˆØª (Ø¨Ø±Ù…Ø¬ÙŠ)
const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSound(f, d, v, type="square") {
    try {
        const o = audio.createOscillator();
        const g = audio.createGain();
        o.type = type;
        o.frequency.setValueAtTime(f, audio.currentTime);
        g.gain.setValueAtTime(v, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + d);
        o.connect(g); g.connect(audio.destination);
        o.start(); o.stop(audio.currentTime + d);
    } catch(e) {}
}

function init() {
    resize();
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹ÙˆØ§Ø¦Ù‚ (Ø¨ÙŠÙˆØª)
    for(let i=0; i<40; i++) {
        walls.push({
            x: (Math.random()-0.5)*800,
            z: (Math.random()-0.5)*800,
            w: 15 + Math.random()*20,
            h: 15 + Math.random()*20,
            color: '#555'
        });
    }
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØªØ§Øª
    for(let i=0; i<15; i++) {
        bots.push({
            x: (Math.random()-0.5)*600,
            z: (Math.random()-0.5)*600,
            hp: 100,
            lastShot: 0
        });
    }

    document.getElementById('status').innerText = "Ø¬Ø§Ù‡Ø² ØªÙ…Ø§Ù…Ø§Ù‹!";
    document.getElementById('start-bt').style.display = "block";
}

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
}

window.addEventListener('resize', resize);

document.getElementById('start-bt').onclick = () => {
    document.getElementById('loading').style.display = 'none';
    if(audio.state === 'suspended') audio.resume();
    requestAnimationFrame(update);
};

// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³
let touchX, touchY;
canvas.addEventListener('touchstart', e => {
    const t = e.touches[0];
    if(t.clientX < width/2) { touchX = t.clientX; touchY = t.clientY; }
});
canvas.addEventListener('touchmove', e => {
    const t = e.touches[0];
    if(t.clientX < width/2) {
        player.moveF = (touchY - t.clientY) / 30;
        player.moveS = (t.clientX - touchX) / 30;
    } else {
        if(player.lx) {
            player.yaw -= (t.clientX - player.lx) * 0.005;
            player.pitch -= (t.clientY - player.ly) * 0.005;
            player.pitch = Math.max(-1.4, Math.min(1.4, player.pitch));
        }
        player.lx = t.clientX; player.ly = t.clientY;
    }
});
window.addEventListener('touchend', () => { player.moveF = 0; player.moveS = 0; player.lx = null; });

document.getElementById('fire-btn').onclick = () => {
    playSound(150, 0.1, 0.2, "sawtooth");
    player.pitch += 0.02; // Ø§Ø±ØªØ¯Ø§Ø¯
    // Ù†Ø¸Ø§Ù… Ø¥ØµØ§Ø¨Ø© Ø¨Ø³ÙŠØ·
    bots.forEach(b => {
        const dx = b.x - player.x;
        const dz = b.z - player.z;
        const dist = Math.sqrt(dx*dx + dz*dz);
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Ø¸Ø±
        const angleToBot = Math.atan2(dx, dz);
        const diff = Math.abs(angleToBot - (player.yaw + Math.PI));
        if(dist < 50 && (diff < 0.2 || diff > 6.1)) {
            b.hp -= 35;
            if(b.hp <= 0) {
                b.dead = true;
                player.kills++;
                document.getElementById('kills').innerText = player.kills;
                document.getElementById('alive').innerText = bots.filter(x=>!x.dead).length + 1;
            }
        }
    });
};

document.getElementById('jump-btn').onclick = () => {
    if(player.onGround) { player.vY = 8; player.onGround = false; playSound(200, 0.1, 0.1); }
};

function update() {
    // Ø§Ù„Ø­Ø±ÙƒØ©
    const speed = 0.4;
    player.x += (Math.sin(player.yaw) * player.moveF + Math.cos(player.yaw) * player.moveS) * speed;
    player.z += (Math.cos(player.yaw) * player.moveF - Math.sin(player.yaw) * player.moveS) * speed;
    
    // Ø¬Ø§Ø°Ø¨ÙŠØ©
    player.vY -= 0.4;
    const groundY = 0;
    let currentY = (player.y || 2) + player.vY;
    if(currentY < 2) { currentY = 2; player.vY = 0; player.onGround = true; }
    player.y = currentY;

    // Ø§Ù„Ø²ÙˆÙ†
    zoneRadius -= 0.05;
    const dist = Math.sqrt(player.x*player.x + player.z*player.z);
    if(dist > zoneRadius) {
        player.hp -= 0.1;
        document.getElementById('health-fill').style.width = player.hp + "%";
        document.getElementById('health-fill').style.background = "blue";
    } else {
        document.getElementById('health-fill').style.background = "linear-gradient(90deg, #f00, #0f0)";
    }

    // Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø¨ÙˆØªØ§Øª
    bots.forEach(b => {
        if(b.dead) return;
        const d = Math.sqrt((b.x-player.x)**2 + (b.z-player.z)**2);
        if(d < 60 && Date.now() - b.lastShot > 2000) {
            b.lastShot = Date.now();
            playSound(100, 0.1, 0.05, "sine");
            player.hp -= 5;
            document.getElementById('health-fill').style.width = player.hp + "%";
            document.getElementById('damage-flash').style.display = 'block';
            setTimeout(() => document.getElementById('damage-flash').style.display = 'none', 100);
        }
    });

    draw();
    requestAnimationFrame(update);
}

function draw() {
    // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ù„Ø³Ù…Ø§Ø¡)
    ctx.fillStyle = '#7ec0ff';
    ctx.fillRect(0, 0, width, height);

    // Ø§Ù„Ø£Ø±Ø¶ÙŠØ© (Ø¨Ù…Ù†Ø¸ÙˆØ± Ø¨Ø³ÙŠØ·)
    ctx.fillStyle = '#3d5e2a';
    ctx.fillRect(0, height/2, width, height/2);

    // Ø±Ù†Ø¯Ø± Ø§Ù„Ø¹Ø§Ù„Ù… (Pseudo 3D)
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ù†Ø¸Ø§Ù… Ø±Ù†Ø¯Ø± Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ Ù„Ø§ ÙŠØ³Ø¨Ø¨ Ø³ÙˆØ§Ø¯ Ø§Ù„Ø´Ø§Ø´Ø©
    const viewDist = 200;
    
    // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
    walls.forEach(w => {
        const dx = w.x - player.x;
        const dz = w.z - player.z;
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        const rx = dx * Math.cos(player.yaw) - dz * Math.sin(player.yaw);
        const rz = dx * Math.sin(player.yaw) + dz * Math.cos(player.yaw);

        if(rz > 5) {
            const screenX = (rx / rz) * width + width/2;
            const size = (w.w / rz) * width;
            const h = (w.h / rz) * height;
            ctx.fillStyle = w.color;
            ctx.fillRect(screenX - size/2, height/2 - h + (player.y*10/rz), size, h);
        }
    });

    // Ø±Ø³Ù… Ø§Ù„Ø¨ÙˆØªØ§Øª
    bots.forEach(b => {
        if(b.dead) return;
        const dx = b.x - player.x;
        const dz = b.z - player.z;
        const rx = dx * Math.cos(player.yaw) - dz * Math.sin(player.yaw);
        const rz = dx * Math.sin(player.yaw) + dz * Math.cos(player.yaw);

        if(rz > 5) {
            const screenX = (rx / rz) * width + width/2;
            const h = (40 / rz) * height;
            ctx.fillStyle = 'red';
            ctx.fillRect(screenX - h/4, height/2 - h + (player.y*10/rz), h/2, h);
        }
    });

    // Ø±Ø³Ù… Ø§Ù„Ø³Ù„Ø§Ø­ M416 (FPP)
    ctx.save();
    ctx.translate(width*0.7, height*0.8 + Math.sin(Date.now()/200)*5);
    ctx.rotate(-0.2);
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, 150, 40); // Ø¬Ø³Ù… Ø§Ù„Ø³Ù„Ø§Ø­
    ctx.fillRect(100, -20, 10, 40); // Ø§Ù„Ù†Ø§Ø¸ÙˆØ±
    ctx.restore();

    // Ø§Ù„ÙƒØ±ÙˆØ³ Ù‡ÙŠØ±
    ctx.strokeStyle = '#0f0';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(width/2, height/2, 10, 0, Math.PI*2);
    ctx.stroke();

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙŠÙ†ÙŠ Ù…Ø§Ø¨
    document.getElementById('player-marker').style.left = (50 + player.x/10) + "%";
    document.getElementById('player-marker').style.top = (50 + player.z/10) + "%";
    const z = document.getElementById('zone-circle');
    z.style.width = (zoneRadius/5) + "%";
    z.style.height = (zoneRadius/5) + "%";
    z.style.left = "50%"; z.style.top = "50%";
}

init();

</script>
</body>
</html>